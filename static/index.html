<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Azure CloudOps Intelligence Agent</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 23 23'%3E%3Cpath fill='%23f25022' d='M0 0h11v11H0z'/%3E%3Cpath fill='%237fba00' d='M12 0h11v11H12z'/%3E%3Cpath fill='%2300a4ef' d='M0 12h11v11H0z'/%3E%3Cpath fill='%23ffb900' d='M12 12h11v11H12z'/%3E%3C/svg%3E">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Modern Light Theme - Figma Style */
            --primary: #0078D4;
            --primary-dark: #106EBE;
            --primary-light: #E6F2FB;
            --secondary: #5C2D91;
            --accent: #00B7C3;
            --success: #107C10;
            --success-light: #DFF6DD;
            --warning: #FF8C00;
            --warning-light: #FFF4CE;
            --danger: #D13438;
            --danger-light: #FDE7E9;
            
            /* Backgrounds */
            --background: #F5F7FA;
            --surface: #FFFFFF;
            --surface-secondary: #FAFBFC;
            --surface-hover: #F0F4F8;
            
            /* Text */
            --text-primary: #1A1A2E;
            --text-secondary: #5C6B7A;
            --text-muted: #8E99A4;
            --text-inverse: #FFFFFF;
            
            /* Borders */
            --border: #E1E5EB;
            --border-light: #F0F2F5;
            
            /* Shadows - Figma Style */
            --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.04);
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.10);
            --shadow-xl: 0 16px 48px rgba(0, 0, 0, 0.12);
            --shadow-primary: 0 4px 14px rgba(0, 120, 212, 0.25);
            
            /* Gradients */
            --gradient-primary: linear-gradient(135deg, #0078D4 0%, #106EBE 100%);
            --gradient-accent: linear-gradient(135deg, #00B7C3 0%, #0078D4 100%);
            --gradient-hero: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            
            /* Border Radius - Modern */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --radius-full: 9999px;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--background);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Header - Modern Clean Style */
        .header {
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            padding: 0 32px;
            height: 72px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            z-index: 100;
            box-shadow: var(--shadow-sm);
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-primary);
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .brand:hover {
            transform: translateX(2px);
        }

        .logo {
            width: 108px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: flex-start;
        }

        .logo img {
            width: 100%;
            height: auto;
        }

        .subscription-selector {
            display: flex;
            align-items: center;
            margin-right: 24px;
        }

        .subscription-selector select {
            background: var(--surface-secondary);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 10px 16px;
            border-radius: var(--radius-md);
            font-size: 14px;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 240px;
        }

        .subscription-selector select:hover {
            border-color: var(--primary);
            background: var(--surface);
        }

        .subscription-selector select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-light);
        }

        .brand-text h1 {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .brand-text p {
            font-size: 11px;
            color: var(--primary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .header-stats {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .header-stat {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 16px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-xs);
            transition: all 0.2s ease;
            min-width: 110px;
        }

        .header-stat > div:first-child {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .header-stat:hover {
            box-shadow: var(--shadow-sm);
            transform: translateY(-1px);
        }

        .header-stat-icon {
            font-size: 20px;
        }

        .header-stat-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.2;
            min-height: 22px;
        }

        .header-stat-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            line-height: 1.2;
            margin-top: 2px;
        }

        .header-stat.success .header-stat-value {
            color: var(--success);
        }

        .header-stat.warning .header-stat-value {
            color: var(--warning);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 16px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: var(--shadow-xs);
        }

        .user-profile:hover {
            background: var(--surface-hover);
            border-color: var(--primary);
            box-shadow: var(--shadow-sm);
        }

        .user-avatar {
            width: 38px;
            height: 38px;
            background: var(--gradient-primary);
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
            color: var(--text-inverse);
            box-shadow: var(--shadow-primary);
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .user-email {
            font-size: 11px;
            color: var(--text-muted);
        }

        .logout-btn {
            padding: 10px 20px;
            background: var(--danger-light);
            border: 1px solid rgba(209, 52, 56, 0.2);
            color: var(--danger);
            border-radius: var(--radius-md);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .logout-btn:hover {
            background: var(--danger);
            color: var(--text-inverse);
            border-color: var(--danger);
        }

        /* Main Content */
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Sidebar - Modern Card Style */
        .sidebar {
            width: 320px;
            background: var(--surface);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            box-shadow: var(--shadow-sm);
        }

        .sidebar::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: transparent;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        .sidebar::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }

        .sidebar-section {
            padding: 20px;
            border-bottom: 1px solid var(--border-light);
        }

        .section-title {
            font-size: 11px;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Insight Cards - Modern Figma Style */
        .insight-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 18px;
            margin-bottom: 12px;
            position: relative;
            overflow: hidden;
            transition: all 0.2s ease;
            box-shadow: var(--shadow-xs);
        }

        .insight-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .insight-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
        }

        .insight-card.success::before {
            background: var(--success);
        }

        .insight-card.warning::before {
            background: var(--warning);
        }

        .insight-card.danger::before {
            background: var(--danger);
        }

        .insight-card.success {
            background: linear-gradient(135deg, var(--success-light) 0%, var(--surface) 100%);
        }

        .insight-card.warning {
            background: linear-gradient(135deg, var(--warning-light) 0%, var(--surface) 100%);
        }

        .insight-card.danger {
            background: linear-gradient(135deg, var(--danger-light) 0%, var(--surface) 100%);
        }

        .insight-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .insight-icon {
            font-size: 24px;
        }

        .insight-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .insight-value {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .insight-card.success .insight-value {
            color: var(--success);
        }

        .insight-card.warning .insight-value {
            color: var(--warning);
        }

        .insight-card.danger .insight-value {
            color: var(--danger);
        }

        .insight-subtitle {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .insight-footer {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border-light);
            font-size: 11px;
            color: var(--text-muted);
        }

        /* Category Section - Modern Accordion */
        .category-section {
            margin-bottom: 8px;
        }

        .category-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 16px;
            background: var(--surface-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 8px;
        }

        .category-header:hover {
            background: var(--surface-hover);
            border-color: var(--primary);
        }

        .category-header.active {
            background: var(--primary);
            border-color: var(--primary);
        }

        .category-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .category-icon {
            width: 36px;
            height: 36px;
            background: var(--surface-secondary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            padding: 6px;
        }

        .category-icon img {
            width: 24px;
            height: 24px;
            object-fit: contain;
        }

        .category-header.active .category-icon {
            background: rgba(255, 255, 255, 0.2);
        }

        .category-header.active .category-icon img {
            filter: brightness(0) invert(1);
        }

        .category-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .category-toggle {
            font-size: 20px;
            transition: transform 0.3s;
        }

        .category-header.active .category-toggle {
            transform: rotate(180deg);
        }

        .category-prompts {
            display: none;
            padding: 8px 0;
        }

        .category-prompts.active {
            display: block;
        }

        .prompt-item {
            padding: 12px 16px;
            margin: 4px 0;
            background: var(--surface);
            border: 1px solid transparent;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 13px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .prompt-item:hover {
            background: var(--primary-light);
            border-color: var(--primary);
            color: var(--text-primary);
            transform: translateX(4px);
        }

        .prompt-icon {
            font-size: 16px;
        }

        /* Chat Area - Modern Light Style */
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            background: var(--background);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 32px;
            background: var(--background);
            position: relative;
        }

        .chat-messages::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(0, 120, 212, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(0, 183, 195, 0.03) 0%, transparent 50%);
            pointer-events: none;
        }

        .chat-messages::-webkit-scrollbar {
            width: 8px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: transparent;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }

        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }

        /* Welcome State - Modern Card Design */
        .welcome-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            padding: 48px;
            position: relative;
            z-index: 1;
        }

        .welcome-icon {
            width: 100px;
            height: 100px;
            background: var(--gradient-primary);
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 28px;
            box-shadow: var(--shadow-primary);
            animation: float 3s ease-in-out infinite;
            padding: 24px;
        }

        .welcome-icon svg {
            width: 100%;
            height: 100%;
            display: block;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        .welcome-state h2 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        .welcome-state p {
            font-size: 15px;
            color: var(--text-secondary);
            margin-bottom: 40px;
            max-width: 600px;
            line-height: 1.6;
        }

        .welcome-categories {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            max-width: 1200px;
            width: 100%;
        }

        .welcome-category-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 24px;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        .welcome-category-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-primary);
            transform: scaleX(0);
            transition: transform 0.2s ease;
        }

        .welcome-category-card:hover {
            border-color: var(--primary);
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .welcome-category-card:hover::before {
            transform: scaleX(1);
        }

        .welcome-category-icon {
            font-size: 36px;
            margin-bottom: 16px;
            display: block;
            width: 48px;
            height: 48px;
        }

        .welcome-category-icon img {
            width: 48px;
            height: 48px;
            object-fit: contain;
        }

        .welcome-category-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .welcome-category-desc {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 16px;
        }

        .welcome-category-count {
            font-size: 11px;
            color: var(--text-muted);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Messages - Modern Card Style */
        .message {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-avatar {
            width: 42px;
            height: 42px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: var(--gradient-primary);
            box-shadow: var(--shadow-primary);
            color: var(--text-inverse);
        }

        .message.assistant .message-avatar {
            background: var(--surface);
            border: 2px solid var(--border);
            color: var(--primary);
        }

        .message-content {
            flex: 1;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 18px 22px;
            color: var(--text-primary);
            line-height: 1.7;
            max-width: 85%;
            box-shadow: var(--shadow-sm);
        }

        .message.user .message-content {
            background: var(--gradient-primary);
            border: none;
            box-shadow: var(--shadow-primary);
            color: var(--text-inverse);
        }

        /* Table Styling - Modern Clean Design */
        .message-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 16px 0;
            background: var(--surface);
            border-radius: var(--radius-md);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        .message-content thead {
            background: var(--primary);
        }

        .message-content th {
            padding: 14px 16px;
            text-align: left;
            font-weight: 600;
            color: var(--text-inverse);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: none;
        }

        .message-content td {
            padding: 14px 16px;
            border-bottom: 1px solid var(--border-light);
            color: var(--text-primary);
            font-size: 14px;
        }

        .message-content tbody tr {
            transition: all 0.2s ease;
        }

        .message-content tbody tr:hover {
            background: var(--surface-hover);
        }

        .message-content tbody tr:last-child td {
            border-bottom: none;
        }

        .message-content .table-wrapper {
            overflow-x: auto;
            max-width: 100%;
            margin: 16px 0;
            border-radius: var(--radius-md);
            border: 1px solid var(--border);
            -webkit-overflow-scrolling: touch;
        }

        /* Scrollbar styling for tables */
        .message-content .table-wrapper::-webkit-scrollbar {
            height: 10px;
        }

        .message-content .table-wrapper::-webkit-scrollbar-track {
            background: var(--surface);
            border-radius: 5px;
        }

        .message-content .table-wrapper::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 5px;
        }

        .message-content .table-wrapper::-webkit-scrollbar-thumb:hover {
            background: var(--secondary);
        }

        /* Ensure tables are wide enough to scroll */
        .message-content table {
            min-width: 800px;
            width: 100%;
        }

        .message-content strong {
            color: var(--primary);
            font-weight: 600;
        }

        .message-content .cost-highlight {
            color: var(--warning);
            font-weight: 700;
        }

        .message-content .savings-highlight {
            color: var(--success);
            font-weight: 700;
        }

        .message-content .danger-highlight {
            color: var(--danger);
            font-weight: 700;
        }

        /* CSV Export Button */
        .export-csv-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            margin: 8px 0;
            padding: 8px 16px;
            background: var(--gradient-primary);
            border: none;
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .export-csv-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .export-csv-btn svg {
            width: 14px;
            height: 14px;
        }

        .full-export-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .full-export-btn:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
        }

        .table-actions {
            display: flex;
            justify-content: flex-end;
            padding: 8px 0;
            gap: 10px;
            flex-wrap: wrap;
        }

        .row-count-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            background: var(--surface-hover);
            border-radius: 12px;
            font-size: 11px;
            color: var(--text-secondary);
        }

        /* About Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(4px);
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
            transition: color 0.3s;
        }

        .modal-close:hover {
            color: var(--danger);
        }

        .modal-body {
            padding: 24px;
        }

        .modal-body h3 {
            font-size: 16px;
            font-weight: 600;
            color: var(--primary);
            margin-top: 16px;
            margin-bottom: 8px;
        }

        .modal-body p {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .modal-body ul {
            list-style: none;
            padding: 0;
        }

        .modal-body li {
            color: var(--text-secondary);
            padding: 8px 0;
            padding-left: 24px;
            position: relative;
        }

        .modal-body li::before {
            content: '‚úì';
            position: absolute;
            left: 0;
            color: var(--success);
        }

        .developer-info {
            background: var(--surface-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-top: 16px;
            text-align: center;
        }

        .developer-info .name {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary);
        }

        .developer-info .role {
            font-size: 12px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Input Area - Modern Clean Style */
        .input-area {
            background: var(--surface);
            border-top: 1px solid var(--border);
            padding: 20px 32px;
            box-shadow: 0 -4px 16px rgba(0, 0, 0, 0.04);
        }

        .input-wrapper {
            display: flex;
            gap: 12px;
            max-width: 1200px;
            margin: 0 auto;
        }

        #userInput {
            flex: 1;
            background: var(--surface-secondary);
            border: 2px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 16px 20px;
            color: var(--text-primary);
            font-size: 15px;
            font-family: inherit;
            resize: none;
            min-height: 70px;
            max-height: 200px;
            transition: all 0.2s ease;
            line-height: 1.6;
        }

        #userInput:focus {
            outline: none;
            border-color: var(--primary);
            background: var(--surface);
            box-shadow: 0 0 0 4px var(--primary-light);
        }

        #userInput::placeholder {
            color: var(--text-muted);
        }

        #sendBtn {
            padding: 16px 36px;
            background: var(--gradient-primary);
            border: none;
            border-radius: var(--radius-lg);
            color: var(--text-inverse);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: var(--shadow-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        #sendBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 120, 212, 0.35);
        }

        #sendBtn:active {
            transform: translateY(0);
        }

        #sendBtn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .header-stats {
                display: none;
            }

            .welcome-categories {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 1024px) {
            .sidebar {
                width: 280px;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }

            .header {
                padding: 0 20px;
            }

            .chat-messages {
                padding: 20px;
            }

            .input-area {
                padding: 16px 20px;
            }
        }
    </style>
</head>
<body>
    <!-- About Modal -->
    <div id="aboutModal" class="modal-overlay" onclick="closeAboutModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2>About Azure CloudOps Intelligence Agent</h2>
                <button class="modal-close" onclick="closeAboutModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="developer-info">
                    <div class="role" style="font-size: 14px; margin-bottom: 5px;">Solution Accelerator Developed by:</div>
                    <div class="name">Zahir Hussain Shah</div>
                    <div class="role">Senior Cloud Solution Architect</div>
                    <div style="margin-top: 10px; font-size: 13px;">
                        <div>üìß <a href="mailto:zahir@zahir.cloud" style="color: var(--accent-primary);">zahir@zahir.cloud</a></div>
                        <div>üåê <a href="https://www.zahir.cloud" target="_blank" style="color: var(--accent-primary);">www.zahir.cloud</a></div>
                    </div>
                </div>

                <p style="margin-top: 20px;">
                    This is a <strong>Solution Accelerator</strong> designed to showcase the agentic capabilities of Azure OpenAI 
                    while integrating with Azure Resource Graph API, Azure Cost Management API, and other key Azure components 
                    to provide comprehensive insights about Azure infrastructure management, operations, and optimization.
                </p>

                <h3>Key Features</h3>
                <ul>
                    <li>Resource Management - Inventory, filtering, and search across all Azure resources</li>
                    <li>Cost Optimization - Cost analysis, trends, comparisons, and savings recommendations</li>
                    <li>Security & Compliance - Defender for Cloud, Azure Policy, public access audit</li>
                    <li>Monitoring & Alerts - Active alerts, monitoring gaps, VM Insights status</li>
                    <li>Tags Management - Tag inventory, compliance, and smart search</li>
                    <li>Azure Policy & Governance - Compliance status, exemptions, non-compliant resources</li>
                    <li>Update Management - Pending updates for VMs and Arc machines</li>
                    <li>Azure Arc Management - Hybrid infrastructure visibility</li>
                    <li>Service-specific Insights - App Services, AKS, SQL, PostgreSQL, MySQL, Cosmos DB, APIM, Storage Accounts</li>
                    <li>AI-powered Automation - Intelligent recommendations and automation opportunities</li>
                </ul>

                <h3>Technology Stack</h3>
                <ul>
                    <li>Azure OpenAI Service with GPT-4 for natural language processing</li>
                    <li>Azure Resource Graph API for cross-subscription resource queries</li>
                    <li>Azure Cost Management API for cost analytics</li>
                    <li>Azure Policy Insights for compliance data</li>
                    <li>FastAPI backend with Python</li>
                    <li>Modern responsive web interface</li>
                </ul>

                <h3>Enterprise Ready</h3>
                <p>
                    Designed for enterprise deployment with support for Azure AD authentication, 
                    multi-subscription management, and secure data handling. All data is retrieved 
                    directly from your Azure environment - no sample or imaginary data.
                </p>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="brand" onclick="goHome()">
            <div class="logo">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 609 130" style="width: 108px; height: 24px;">
                    <path fill="#f25022" d="M0 0h61.3v61.3H0z"/>
                    <path fill="#7fba00" d="M67.7 0H129v61.3H67.7z"/>
                    <path fill="#00a4ef" d="M0 67.7h61.3V129H0z"/>
                    <path fill="#ffb900" d="M67.7 67.7H129V129H67.7z"/>
                    <text x="145" y="95" font-family="Segoe UI, Arial, sans-serif" font-size="72" font-weight="600" fill="#5E5E5E">Microsoft</text>
                </svg>
            </div>
            <div class="brand-text">
                <h1>Azure CloudOps Intelligence Agent</h1>
                <p>AI-Powered Azure InfraOps & Management</p>
            </div>
        </div>
        
        <div class="subscription-selector">
            <label for="subscriptionSelect" style="font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-right: 8px;">Context:</label>
            <select id="subscriptionSelect" onchange="changeSubscription()">
                <option value="all">All Subscriptions</option>
                <option value="loading" selected>Loading hierarchy...</option>
            </select>
        </div>

        <div class="header-stats">
            <div class="header-stat success">
                <div>
                    <div class="header-stat-value" id="healthScore">--</div>
                    <div class="header-stat-label">Health</div>
                </div>
                <div class="header-stat-icon">üíö</div>
            </div>
            <div class="header-stat warning">
                <div>
                    <div class="header-stat-value" id="monthlyCost">--</div>
                    <div class="header-stat-label">Cost</div>
                </div>
                <div class="header-stat-icon">üí∞</div>
            </div>
            <div class="header-stat">
                <div>
                    <div class="header-stat-value" id="resourceCount">--</div>
                    <div class="header-stat-label">Resources</div>
                </div>
                <div class="header-stat-icon">üì¶</div>
            </div>
        </div>

        <div class="header-actions">
            <div class="user-profile" id="userProfile" style="display: none;">
                <div class="user-avatar" id="userAvatar">U</div>
                <div class="user-info">
                    <span class="user-name" id="userName">Loading...</span>
                    <span class="user-email" id="userEmail"></span>
                </div>
            </div>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
    </header>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Sidebar -->
        <aside class="sidebar">
            <!-- Insights Section -->
            <div class="sidebar-section">
                <h3 class="section-title">
                    <span>üìä</span> Quick Start
                </h3>
                
                <div class="insight-card success">
                    <div class="insight-header">
                        <div class="insight-icon">üõ°Ô∏è</div>
                        <div class="insight-title">Security</div>
                    </div>
                    <div class="insight-value" style="font-size: 16px;">Check Status</div>
                    <div class="insight-subtitle">Review security recommendations</div>
                    <div class="insight-footer" onclick="quickPrompt('Show Microsoft Defender for Cloud security recommendations for my subscription.')" style="cursor: pointer; color: var(--primary);">
                        ‚Üí Get Security Assessment
                    </div>
                </div>

                <div class="insight-card warning">
                    <div class="insight-header">
                        <div class="insight-icon">üí°</div>
                        <div class="insight-title">Cost Savings</div>
                    </div>
                    <div class="insight-value" style="font-size: 16px;">Find Savings</div>
                    <div class="insight-subtitle">Identify optimization opportunities</div>
                    <div class="insight-footer" onclick="quickPrompt('Find all cost savings opportunities in my subscription. Show ACTUAL resource names with potential savings.')" style="cursor: pointer; color: var(--primary);">
                        ‚Üí Analyze Cost Savings
                    </div>
                </div>

                <div class="insight-card success">
                    <div class="insight-header">
                        <div class="insight-icon">üì¶</div>
                        <div class="insight-title">Resources</div>
                    </div>
                    <div class="insight-value" style="font-size: 16px;">View Inventory</div>
                    <div class="insight-subtitle">Full resource inventory</div>
                    <div class="insight-footer" onclick="quickPrompt('List ALL resources in my current subscription with comprehensive details.')" style="cursor: pointer; color: var(--primary);">
                        ‚Üí Show All Resources
                    </div>
                </div>
            </div>

            <!-- Categories Section -->
            <div class="sidebar-section">
                <h3 class="section-title">
                    <span>üéØ</span> Quick Actions
                </h3>

                <!-- Resource Management Category -->
                <div class="category-section">
                    <div class="category-header" onclick="toggleCategory('resources')">
                        <div class="category-info">
                            <div class="category-icon"><img src="/Icons/general/10001-icon-service-All-Resources.svg" alt="Resources"></div>
                            <div class="category-name">Resource Management</div>
                        </div>
                        <div class="category-toggle">‚ñº</div>
                    </div>
                    <div class="category-prompts" id="category-resources">
                        <div class="prompt-item" onclick="quickPrompt('List ALL resources in my current subscription with comprehensive details. Show table with columns: Resource Name, Resource Type, Resource Group, Subscription, Location, SKU/Size, Status, Tags. Include all resource properties available. Do not show any imaginary or placeholder values - only actual data from Azure.')">
                            <span class="prompt-icon">üìã</span>
                            <span>All resources (full inventory)</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('I want to filter Azure resources. Present these filtering options with numbered choices: 1) Filter by Resource Group (ask which), 2) Filter by Resource Type (ask which type), 3) Filter by Location/Region (ask which), 4) Filter by Tag (ask tag name and value), 5) Filter by Subscription (if multiple). Wait for my selection, then show results in a table with: Resource Name, Type, Resource Group, Location, SKU, Status, Tags.')">
                            <span class="prompt-icon">üîç</span>
                            <span>Filter resources by criteria</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show me a summary of resources grouped by type. Include: Resource Type, Count, Primary Locations, Common Tags. Help me understand my resource distribution.')">
                            <span class="prompt-icon">üìä</span>
                            <span>Resource inventory summary</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Search for resources by name. Ask me what name or partial name to search for, then show matching resources with: Resource Name, Type, Resource Group, Location, Subscription, Status.')">
                            <span class="prompt-icon">üîé</span>
                            <span>Search resources by name</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show ALL Virtual Machines in my subscription with details: VM Name, Resource Group, Location, VM Size, OS Type, Power State, Private IP, Public IP (if any), Tags. Only show actual Azure data.')">
                            <span class="prompt-icon">üíª</span>
                            <span>List all Virtual Machines</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show ALL Storage Accounts in my subscription with: Name, Resource Group, Location, SKU, Access Tier, Public Access status, Private Endpoint status, Replication Type, Tags.')">
                            <span class="prompt-icon">üíæ</span>
                            <span>List all Storage Accounts</span>
                        </div>
                    </div>
                </div>

                <!-- Cost Optimization Category -->
                <div class="category-section">
                    <div class="category-header" onclick="toggleCategory('cost')">
                        <div class="category-info">
                            <div class="category-icon"><img src="/Icons/general/10019-icon-service-Cost-Management.svg" alt="Cost"></div>
                            <div class="category-name">Cost Optimization</div>
                        </div>
                        <div class="category-toggle">‚ñº</div>
                    </div>
                    <div class="category-prompts" id="category-cost">
                        <div class="prompt-item" onclick="quickPrompt('Show my current month Azure costs breakdown. Include: Total Cost, Cost by Service, Cost by Resource Group, Top 10 most expensive resources with ACTUAL resource names and costs from Azure Cost Management. Do not show any placeholder or estimated values.')">
                            <span class="prompt-icon">üìä</span>
                            <span>Current month costs overview</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Compare my Azure costs: Show this week vs last week, and this month vs last month comparison. Include: Period, Total Cost, Change (%), Top changing services, Resources with biggest cost increase. Use actual data from Azure Cost Management.')">
                            <span class="prompt-icon">üìà</span>
                            <span>Compare costs (week/month)</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show my Azure cost trends for the last 3 months. Include monthly totals, cost by service category, and identify any unusual spending patterns or anomalies.')">
                            <span class="prompt-icon">üìÜ</span>
                            <span>Cost trends (last 3 months)</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('I want to analyze costs by category. Present options: 1) By Subscription, 2) By Resource Group, 3) By Tag (CostCenter/Department/Environment), 4) By Service type, 5) By Location. Wait for my selection then show detailed breakdown with ACTUAL costs.')">
                            <span class="prompt-icon">üè∑Ô∏è</span>
                            <span>Costs by category/tag</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Find all cost savings opportunities in my subscription. Show ACTUAL resource names with: Resource Name, Type, Current Monthly Cost, Issue (deallocated VM/orphaned disk/unattached IP/oversized), Recommended Action, Potential Monthly Savings. Calculate total potential savings.')">
                            <span class="prompt-icon">üí°</span>
                            <span>Cost savings opportunities</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show Azure Advisor cost recommendations for my subscription. Include: Recommendation, Affected Resource, Impact Level, Estimated Monthly Savings, Implementation Steps. Only show actual recommendations from Azure Advisor.')">
                            <span class="prompt-icon">üéØ</span>
                            <span>Azure Advisor cost recommendations</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('I want cost advisories at a specific level. Ask me: 1) Subscription level, 2) Resource Group level (ask which RG), 3) Resource level (ask which resource). Then show cost analysis and optimization recommendations for that scope.')">
                            <span class="prompt-icon">üîç</span>
                            <span>Cost advisories by scope</span>
                        </div>
                    </div>
                </div>

                <!-- Security & Compliance Category -->
                <div class="category-section">
                    <div class="category-header" onclick="toggleCategory('security')">
                        <div class="category-info">
                            <div class="category-icon"><img src="/Icons/security/10241-icon-service-Microsoft-Defender-for-Cloud.svg" alt="Security"></div>
                            <div class="category-name">Security & Compliance</div>
                        </div>
                        <div class="category-toggle">‚ñº</div>
                    </div>
                    <div class="category-prompts" id="category-security">
                        <div class="prompt-item" onclick="quickPrompt('Show Microsoft Defender for Cloud security recommendations for my subscription. Include: Recommendation, Severity (Critical/High/Medium/Low), Affected Resources Count, Category (Compute/Network/Data/Identity), Remediation Steps. Only show actual recommendations from Defender for Cloud.')">
                            <span class="prompt-icon">üõ°Ô∏è</span>
                            <span>Defender for Cloud recommendations</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show Azure Policy compliance status. I want to choose the scope: 1) Subscription level, 2) Resource Group level (ask which), 3) Resource level (ask which). Then show: Resource Name, Resource Type, Location, Resource Group, Compliance Status, Policy Name, Assignment Name, Last Evaluation Date. Only show actual policy compliance data.')">
                            <span class="prompt-icon">üìú</span>
                            <span>Policy compliance by scope</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show all resources with PUBLIC ACCESS enabled. Include: Resource Name, Resource Type, Resource Group, Location, Public Access Type, Risk Level, Recommendation. Focus on Storage Accounts, SQL Servers, Key Vaults, Web Apps, and any PaaS service with public endpoint.')">
                            <span class="prompt-icon">üåê</span>
                            <span>Resources with public access</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show PaaS resources that are ELIGIBLE for Private Endpoints but do NOT have Private Endpoints configured. Include: Resource Name, Resource Type, Resource Group, Location, Current Network Access, Risk Level, Private Endpoint Recommendation.')">
                            <span class="prompt-icon">üîê</span>
                            <span>PaaS without Private Endpoints</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Review Network Security Groups (NSGs) security. Show: NSG Name, Associated Resources, Total Rules, Risky Rules (Any/Any or 0.0.0.0/0), Open Sensitive Ports (RDP 3389, SSH 22, SQL 1433), Risk Level, Recommendations.')">
                            <span class="prompt-icon">üåê</span>
                            <span>NSG security review</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show VMs without backup configured in Azure Backup. Include: VM Name, Resource Group, Location, Backup Status, Risk Level, Recommendation. Help me identify VMs that need backup protection.')">
                            <span class="prompt-icon">üíæ</span>
                            <span>VMs without backup</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show security compliance summary. Categorize findings by: 1) Defender for Cloud issues, 2) Azure Policy non-compliance, 3) Network security issues, 4) Data protection gaps. Include count and severity for each category.')">
                            <span class="prompt-icon">üìä</span>
                            <span>Security compliance summary</span>
                        </div>
                    </div>
                </div>

                <!-- Monitoring & Alerts Category -->
                <div class="category-section">
                    <div class="category-header" onclick="toggleCategory('monitoring')">
                        <div class="category-info">
                            <div class="category-icon"><img src="/Icons/management + governance/00001-icon-service-Monitor.svg" alt="Monitoring"></div>
                            <div class="category-name">Monitoring & Alerts</div>
                        </div>
                        <div class="category-toggle">‚ñº</div>
                    </div>
                    <div class="category-prompts" id="category-monitoring">
                        <div class="prompt-item" onclick="quickPrompt('Show ALL active alerts in my subscription. I want to filter by: 1) Subscription level, 2) Resource Group level (ask which), 3) Resource level (ask which). Show: Alert Name, Severity, Resource, Triggered Time, Status, Description. Group by severity (Critical first).')">
                            <span class="prompt-icon">üîî</span>
                            <span>Active alerts (with filters)</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show Virtual Machines NOT enabled for Azure Monitor (missing Azure Monitor Agent or Log Analytics extension). Include: VM Name, Resource Group, OS Type, Power State, Agent Status, Recommendation.')">
                            <span class="prompt-icon">üíª</span>
                            <span>VMs without Azure Monitor</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show Azure Arc machines NOT enabled for Azure Monitor. Include: Machine Name, Resource Group, OS Type, Agent Status, Azure Monitor Extension Status, Recommendation.')">
                            <span class="prompt-icon">üåê</span>
                            <span>Arc machines without Azure Monitor</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show Virtual Machines NOT enabled for VM Insights. Include: VM Name, Resource Group, OS Type, Power State, VM Insights Status, Dependency Agent Status, Recommendation.')">
                            <span class="prompt-icon">üìä</span>
                            <span>VMs without VM Insights</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show Azure Arc machines NOT enabled for VM Insights. Include: Machine Name, Resource Group, OS Type, Status, VM Insights Status, Recommendation.')">
                            <span class="prompt-icon">üìà</span>
                            <span>Arc machines without VM Insights</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show Virtual Machines NOT enabled for Dependency Agent/extensions. Include: VM Name, Resource Group, OS Type, Dependency Agent Status, Map Feature Status, Recommendation.')">
                            <span class="prompt-icon">üîó</span>
                            <span>VMs without Dependency Agent</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show Azure Arc machines NOT enabled for Dependency monitoring. Include: Machine Name, Resource Group, Status, Dependency Extension Status, Recommendation.')">
                            <span class="prompt-icon">üîó</span>
                            <span>Arc without Dependency Agent</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show Virtual Machines NOT enabled for Change Tracking. Include: VM Name, Resource Group, OS Type, Change Tracking Status, Automation Account Association, Recommendation.')">
                            <span class="prompt-icon">üìù</span>
                            <span>VMs without Change Tracking</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show Azure Arc machines NOT enabled for Change Tracking. Include: Machine Name, Resource Group, OS Type, Status, Change Tracking Status, Recommendation.')">
                            <span class="prompt-icon">üìù</span>
                            <span>Arc without Change Tracking</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show Virtual Machine Scale Sets NOT enabled for monitoring. Include: VMSS Name, Resource Group, Instance Count, Monitoring Status, Diagnostics Status, Recommendation.')">
                            <span class="prompt-icon">‚öñÔ∏è</span>
                            <span>VMSS without monitoring</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show AKS clusters NOT enabled for monitoring (Container Insights). Include: AKS Name, Resource Group, Node Count, Monitoring Status, Log Analytics Workspace, Recommendation.')">
                            <span class="prompt-icon">‚ò∏Ô∏è</span>
                            <span>AKS without monitoring</span>
                        </div>
                    </div>
                </div>

                <!-- Tags Management Category -->
                <div class="category-section">
                    <div class="category-header" onclick="toggleCategory('tags')">
                        <div class="category-info">
                            <div class="category-icon"><img src="/Icons/general/10014-icon-service-Tag.svg" alt="Tags"></div>
                            <div class="category-name">Tags Management</div>
                        </div>
                        <div class="category-toggle">‚ñº</div>
                    </div>
                    <div class="category-prompts" id="category-tags">
                        <div class="prompt-item" onclick="quickPrompt('Show high-level tag inventory across my Azure environment. Include: Tag Name, Total Resources Using Tag, Unique Values Count, Most Common Values, Resource Types with Tag, Usage Percentage. Help me understand tag adoption across my subscription.')">
                            <span class="prompt-icon">üìä</span>
                            <span>Tag inventory overview</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('I want to search resources by tag. Ask me to provide the tag name and optionally the value. Support different formats like: Environment=Production, tag:Environment Production, or just Environment:Production. Then show matching resources with: Resource Name, Type, Resource Group, Location, All Tags, Status.')">
                            <span class="prompt-icon">üîç</span>
                            <span>Search by tag (smart search)</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show resources MISSING required tags. Check for resources that SUPPORT tagging but do not have: Environment, CostCenter, Owner/ApplicationOwner tags. Include: Resource Name, Type, Resource Group, Location, Existing Tags, Missing Tags, Tagging Supported.')">
                            <span class="prompt-icon">‚ö†Ô∏è</span>
                            <span>Resources missing tags</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show tag compliance analysis. For each required tag (Environment, CostCenter, Owner), show: Tag Name, Compliant Resources, Non-Compliant Resources, Compliance %, Top Non-Compliant Resource Types. Calculate overall tag compliance score.')">
                            <span class="prompt-icon">‚úÖ</span>
                            <span>Tag compliance analysis</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show all unique tag values for a specific tag. Ask me which tag to analyze (e.g., Environment, CostCenter, Department), then show: Tag Value, Resource Count, Resource Types, Primary Locations.')">
                            <span class="prompt-icon">üìã</span>
                            <span>Tag values breakdown</span>
                        </div>
                    </div>
                </div>

                <!-- Azure Policy Compliance Category -->
                <div class="category-section">
                    <div class="category-header" onclick="toggleCategory('policy')">
                        <div class="category-info">
                            <div class="category-icon"><img src="/Icons/management + governance/10316-icon-service-Policy.svg" alt="Policy"></div>
                            <div class="category-name">Azure Policy & Governance</div>
                        </div>
                        <div class="category-toggle">‚ñº</div>
                    </div>
                    <div class="category-prompts" id="category-policy">
                        <div class="prompt-item" onclick="quickPrompt('Show Azure Policy compliance dashboard. Include: Policy Assignment Name, Definition Name, Compliance State, Compliant Resources, Non-Compliant Resources, Compliance %, Scope, Enforcement Mode. Only show actual data from Azure Policy.')">
                            <span class="prompt-icon">üìä</span>
                            <span>Policy compliance dashboard</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show non-compliant resources with policy details. Include: Resource Name, Resource Type, Location, Resource Group, Subscription, Compliance Status, Policy Name, Assignment Name, Last Evaluation Date, Remediation Available. Only show actual Azure data.')">
                            <span class="prompt-icon">‚ö†Ô∏è</span>
                            <span>Non-compliant resources</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show all policies that are NOT compliant (have non-compliant resources). Include: Policy Name, Non-Compliant Count, Severity, Category, Enforcement Mode, Remediation Type, Priority to Fix.')">
                            <span class="prompt-icon">‚ùå</span>
                            <span>Policies not compliant</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show actual Azure Policy exemptions. Include: Exemption Name, Scope/Level of Exemption, Creation Date, Created By (if available), Expiration Date, Exemption Category, Policy Being Exempted, Justification/Description. Only show real exemptions from Azure, no placeholder data.')">
                            <span class="prompt-icon">üö´</span>
                            <span>Policy exemptions audit</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show policy compliance by scope. Ask me: 1) Subscription level, 2) Resource Group level (ask which), 3) Management Group level. Then show policies affecting that scope with compliance status.')">
                            <span class="prompt-icon">üîç</span>
                            <span>Policy compliance by scope</span>
                        </div>
                    </div>
                </div>

                <!-- Update Management Category -->
                <div class="category-section">
                    <div class="category-header" onclick="toggleCategory('updates')">
                        <div class="category-info">
                            <div class="category-icon"><img src="/Icons/compute/00195-icon-service-Maintenance-Configuration.svg" alt="Updates"></div>
                            <div class="category-name">Update Management</div>
                        </div>
                        <div class="category-toggle">‚ñº</div>
                    </div>
                    <div class="category-prompts" id="category-updates">
                        <div class="prompt-item" onclick="quickPrompt('Show Azure VMs pending updates from Azure Update Manager. Include: VM Name, Resource Type, OS Type, Private IP, Resource Group, Subscription, Power State (Online/Offline), Pending Patches (Critical/Security/Other), Last Patch Installation Date. Get actual data from Update Manager.')">
                            <span class="prompt-icon">üíª</span>
                            <span>VM pending updates</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show Azure Arc machines pending updates from Azure Update Manager. Include: Machine Name, Resource Type, OS Type, IP Address, Resource Group, Subscription, Status (Online/Offline), Pending Patches (Critical/Security/Other), Last Patch Installation Date.')">
                            <span class="prompt-icon">üåê</span>
                            <span>Arc machine pending updates</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show update compliance summary for ALL machines (Azure VMs and Arc servers) from Update Manager. Include: Machine Type, Total Count, Fully Updated, Pending Critical, Pending Security, Pending Other, Reboot Required, Compliance %, Last Assessment Date. Calculate overall compliance score.')">
                            <span class="prompt-icon">üìä</span>
                            <span>Update compliance summary</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show VMs requiring reboot after patch installation. Include: VM Name, Resource Type, OS Type, Resource Group, Reboot Reason, Pending Updates Requiring Reboot, Last Boot Time, Uptime Days, Priority Level.')">
                            <span class="prompt-icon">üîÑ</span>
                            <span>VMs pending reboot</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show Arc servers requiring reboot. Include: Server Name, Resource Type, OS Type, Resource Group, Status, Reboot Reason, Last Boot Time, Priority Level.')">
                            <span class="prompt-icon">üîÅ</span>
                            <span>Arc servers pending reboot</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show machines with failed update installations. Include: Machine Name, Type, Resource Group, Failed Update Name, Failure Reason, Attempted Date, Retry Count, Recommended Action, Impact Level.')">
                            <span class="prompt-icon">‚ùå</span>
                            <span>Failed update installations</span>
                        </div>
                    </div>
                </div>

                <!-- Azure Arc / Hybrid Management Category -->
                <div class="category-section">
                    <div class="category-header" onclick="toggleCategory('arc')">
                        <div class="category-info">
                            <div class="category-icon"><img src="/Icons/management + governance/00756-icon-service-Azure-Arc.svg" alt="Azure Arc"></div>
                            <div class="category-name">Azure Arc Management</div>
                        </div>
                        <div class="category-toggle">‚ñº</div>
                    </div>
                    <div class="category-prompts" id="category-arc">
                        <div class="prompt-item" onclick="quickPrompt('Show me ALL Azure Arc-enabled machines in my current subscription. Provide table: Machine Name, Resource Group, Subscription, OS Type, OS Version, Agent Status, Agent Version, Defender Status, Monitoring Status, Pending Updates, Last Status Change, Location, Compliance Status. Sort by compliance status.')">
                            <span class="prompt-icon">üíª</span>
                            <span>Arc-enabled machines</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show me ALL Azure Arc-enabled SQL Servers in my current subscription. Provide table: SQL Server Name, Resource Group, SQL Version, Edition, Location, Database Count, Status, Patch Level, License Type, Last Inventory Upload, Compliance Status. Sort by SQL Server name.')">
                            <span class="prompt-icon">üóÑÔ∏è</span>
                            <span>Arc-enabled SQL Servers</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show me ALL Azure Arc machines with agent not reporting or disconnected in my current subscription. Provide table: Machine Name, Resource Group, OS Type, Agent Status, Agent Version, Last Status Change, Days Since Last Report, Location, Issue Level, Recommended Action. Sort by days since last report descending.')">
                            <span class="prompt-icon">‚ö†Ô∏è</span>
                            <span>Arc agents not reporting</span>
                        </div>
                    </div>
                </div>

                <!-- AI & Automation Category -->
                <div class="category-section">
                    <div class="category-header" onclick="toggleCategory('automation')">
                        <div class="category-info">
                            <div class="category-icon"><img src="/Icons/management + governance/00022-icon-service-Automation-Accounts.svg" alt="Automation"></div>
                            <div class="category-name">AI & Automation</div>
                        </div>
                        <div class="category-toggle">‚ñº</div>
                    </div>
                    <div class="category-prompts" id="category-automation">
                        <div class="prompt-item" onclick="quickPrompt('Analyze my current subscription for automation opportunities focusing on ALL areas (Deployment, Backup, Scaling, Patching, Monitoring). Provide table: Task/Process, Current Method, Frequency, Time Spent per Week, Automation Tool Recommendation (Azure Automation/Logic Apps/Functions), Implementation Steps, Time Savings, Cost Savings, ROI %.')">
                            <span class="prompt-icon">üí°</span>
                            <span>Automation suggestions</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('I want to set up auto-scaling. Ask me: 1) Which resource (VM Scale Set/App Service/AKS)? 2) Resource group? 3) Scaling metric (CPU/Memory/Requests)? 4) Min/Max instances? Then configure auto-scaling rules.')">
                            <span class="prompt-icon">üìà</span>
                            <span>Auto-scaling rules</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('I want to generate Infrastructure as Code. Ask me: 1) Template type (ARM/Bicep/Terraform)? 2) Which resources to include? 3) Export existing or create new? Then generate the template with best practices.')">
                            <span class="prompt-icon">üìÑ</span>
                            <span>Generate IaC template</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Analyze ALL resources in my current subscription for the last 30 days using AI-driven optimization. Show table: Resource Name, Current SKU, Usage Pattern Analysis, AI-Recommended SKU, Performance Impact, Cost Impact $/month, Confidence %, Risk Level, Implementation Priority. Include total potential savings.')">
                            <span class="prompt-icon">üéØ</span>
                            <span>AI optimization</span>
                        </div>
                    </div>
                </div>

                <!-- Azure App Services Category -->
                <div class="category-section">
                    <div class="category-header" onclick="toggleCategory('appservices')">
                        <div class="category-info">
                            <div class="category-icon"><img src="/Icons/compute/10035-icon-service-App-Services.svg" alt="App Services"></div>
                            <div class="category-name">Azure App Services</div>
                        </div>
                        <div class="category-toggle">‚ñº</div>
                    </div>
                    <div class="category-prompts" id="category-appservices">
                        <div class="prompt-item" onclick="quickPrompt('List ALL App Services in my subscription. Include: App Name, Resource Group, Location, App Service Plan, SKU/Tier, Status, Type (Web App/Function/Container), Default Hostname, HTTPS Only, TLS Version.')">
                            <span class="prompt-icon">üìã</span>
                            <span>List all App Services</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show App Services NOT connected to Application Insights. Include: App Name, Resource Group, Plan, Status, App Insights Status, Recommendation for enabling monitoring.')">
                            <span class="prompt-icon">üìä</span>
                            <span>App Services without App Insights</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show App Services with high CPU utilization. Include: App Name, Resource Group, Plan, Average CPU %, Peak CPU %, Duration, Impact on Performance, Scaling Recommendation.')">
                            <span class="prompt-icon">‚ö°</span>
                            <span>App Services high CPU</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show App Services with PUBLIC ACCESS enabled (no private endpoints or IP restrictions). Include: App Name, Resource Group, Plan, Public Access Status, Network Restrictions, Risk Level, Security Recommendation.')">
                            <span class="prompt-icon">üîì</span>
                            <span>App Services public access</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show App Services health and performance overview. Include: App Name, Status, HTTP Errors, Response Time, Requests/min, Plan Utilization %, Recommendations.')">
                            <span class="prompt-icon">üíö</span>
                            <span>App Services health</span>
                        </div>
                    </div>
                </div>

                <!-- Azure Kubernetes Service Category -->
                <div class="category-section">
                    <div class="category-header" onclick="toggleCategory('aks')">
                        <div class="category-info">
                            <div class="category-icon"><img src="/Icons/compute/10023-icon-service-Kubernetes-Services.svg" alt="AKS"></div>
                            <div class="category-name">Azure Kubernetes (AKS)</div>
                        </div>
                        <div class="category-toggle">‚ñº</div>
                    </div>
                    <div class="category-prompts" id="category-aks">
                        <div class="prompt-item" onclick="quickPrompt('List ALL AKS clusters in my subscription. Include: Cluster Name, Resource Group, Location, Kubernetes Version, Node Pools, Total Nodes, Status, Network Plugin, Monitoring Status.')">
                            <span class="prompt-icon">üìã</span>
                            <span>List all AKS clusters</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show AKS clusters with PUBLIC API server access. Include: Cluster Name, Resource Group, API Server Access Mode, Authorized IP Ranges status, Network Type, Risk Level, Security Recommendation.')">
                            <span class="prompt-icon">üîì</span>
                            <span>AKS with public access</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show AKS clusters with PRIVATE API server access. Include: Cluster Name, Resource Group, Private Cluster Status, Private DNS Zone, VNet Integration, Security Posture.')">
                            <span class="prompt-icon">üîê</span>
                            <span>AKS with private access</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show AKS clusters NOT enabled for Container Insights monitoring. Include: Cluster Name, Resource Group, Monitoring Status, Log Analytics Workspace, Prometheus Metrics status, Recommendation.')">
                            <span class="prompt-icon">üìä</span>
                            <span>AKS without monitoring</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show AKS cluster resource utilization. Include: Cluster Name, CPU Utilization %, Memory Utilization %, Node Pool Status, Pod Count, Scaling Recommendations.')">
                            <span class="prompt-icon">‚ö°</span>
                            <span>AKS resource utilization</span>
                        </div>
                    </div>
                </div>

                <!-- Azure SQL PaaS Category -->
                <div class="category-section">
                    <div class="category-header" onclick="toggleCategory('sql')">
                        <div class="category-info">
                            <div class="category-icon"><img src="/Icons/databases/10130-icon-service-SQL-Database.svg" alt="SQL"></div>
                            <div class="category-name">Azure SQL PaaS</div>
                        </div>
                        <div class="category-toggle">‚ñº</div>
                    </div>
                    <div class="category-prompts" id="category-sql">
                        <div class="prompt-item" onclick="quickPrompt('List ALL Azure SQL Databases in my subscription. Include: Database Name, Server Name, Resource Group, Location, SKU/Tier, DTU/vCores, Max Size, Status, Backup Retention.')">
                            <span class="prompt-icon">üìã</span>
                            <span>List SQL Databases</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('List ALL Azure SQL Managed Instances in my subscription. Include: Instance Name, Resource Group, Location, SKU/Tier, vCores, Storage Size, Status, Subnet, Backup Configuration.')">
                            <span class="prompt-icon">üìã</span>
                            <span>List SQL Managed Instances</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show SQL Databases with low storage utilization (potential cost savings). Include: Database Name, Server, Max Size GB, Used Size GB, Utilization %, Potential Right-sizing, Cost Savings Estimate.')">
                            <span class="prompt-icon">üíæ</span>
                            <span>SQL low disk utilization</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show SQL Managed Instances with low storage utilization. Include: Instance Name, Provisioned Storage GB, Used Storage GB, Utilization %, Cost Optimization Recommendation.')">
                            <span class="prompt-icon">üíæ</span>
                            <span>SQL MI low disk utilization</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show SQL Databases with high CPU utilization. Include: Database Name, Server, DTU/vCore Usage %, Peak CPU %, Duration, Performance Tier, Scaling Recommendation.')">
                            <span class="prompt-icon">‚ö°</span>
                            <span>SQL high CPU utilization</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show SQL Managed Instances with high CPU utilization. Include: Instance Name, vCore Usage %, Peak CPU %, Duration, Current Tier, Scaling Recommendation.')">
                            <span class="prompt-icon">‚ö°</span>
                            <span>SQL MI high CPU utilization</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show Azure SQL Databases with PUBLIC network access enabled. Include: Database Name, Server, Public Network Access, Firewall Rules, Private Endpoint Status, Risk Level, Security Recommendation.')">
                            <span class="prompt-icon">üîì</span>
                            <span>SQL public access enabled</span>
                        </div>
                    </div>
                </div>

                <!-- Virtual Machine Scale Sets Category -->
                <div class="category-section">
                    <div class="category-header" onclick="toggleCategory('vmss')">
                        <div class="category-info">
                            <div class="category-icon"><img src="/Icons/compute/10034-icon-service-VM-Scale-Sets.svg" alt="VMSS"></div>
                            <div class="category-name">VM Scale Sets</div>
                        </div>
                        <div class="category-toggle">‚ñº</div>
                    </div>
                    <div class="category-prompts" id="category-vmss">
                        <div class="prompt-item" onclick="quickPrompt('List ALL Virtual Machine Scale Sets in my subscription. Include: VMSS Name, Resource Group, Location, SKU Size, Instance Count, Orchestration Mode, OS Type, Upgrade Policy, Status.')">
                            <span class="prompt-icon">üìã</span>
                            <span>List all VMSS</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show VMSS scaling configuration. Include: VMSS Name, Min Instances, Max Instances, Current Instances, Autoscale Enabled, Scale Rules, Cooldown Period.')">
                            <span class="prompt-icon">üìà</span>
                            <span>VMSS scaling configuration</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show VMSS with high CPU utilization. Include: VMSS Name, Resource Group, Instance Count, Average CPU %, Scaling Rule Status, Recommendation.')">
                            <span class="prompt-icon">‚ö°</span>
                            <span>VMSS high utilization</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show VMSS without diagnostics or monitoring enabled. Include: VMSS Name, Resource Group, Boot Diagnostics Status, Guest Metrics Status, Azure Monitor Agent Status, Recommendation.')">
                            <span class="prompt-icon">üìä</span>
                            <span>VMSS without monitoring</span>
                        </div>
                    </div>
                </div>

                <!-- PostgreSQL Servers Category -->
                <div class="category-section">
                    <div class="category-header" onclick="toggleCategory('postgresql')">
                        <div class="category-info">
                            <div class="category-icon"><img src="/Icons/databases/10131-icon-service-Azure-Database-PostgreSQL-Server.svg" alt="PostgreSQL"></div>
                            <div class="category-name">PostgreSQL Servers</div>
                        </div>
                        <div class="category-toggle">‚ñº</div>
                    </div>
                    <div class="category-prompts" id="category-postgresql">
                        <div class="prompt-item" onclick="quickPrompt('List ALL Azure Database for PostgreSQL (Flexible) servers in my subscription. Include: Server Name, Resource Group, Location, Version, SKU/Tier, vCores, Storage GB, HA Mode, Status.')">
                            <span class="prompt-icon">üìã</span>
                            <span>List PostgreSQL servers</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show PostgreSQL servers with public network access. Include: Server Name, Resource Group, Public Access Status, Firewall Rules, Private Endpoint Status, SSL Mode, Risk Level.')">
                            <span class="prompt-icon">üîì</span>
                            <span>PostgreSQL public access</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show PostgreSQL servers performance metrics. Include: Server Name, CPU Utilization %, Memory Utilization %, Storage Utilization %, Connections, Recommendation.')">
                            <span class="prompt-icon">‚ö°</span>
                            <span>PostgreSQL performance</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show PostgreSQL servers without backup configured or with low backup retention. Include: Server Name, Backup Retention Days, Geo-Redundant Backup, Last Backup, Recommendation.')">
                            <span class="prompt-icon">üíæ</span>
                            <span>PostgreSQL backup status</span>
                        </div>
                    </div>
                </div>

                <!-- MySQL Servers Category -->
                <div class="category-section">
                    <div class="category-header" onclick="toggleCategory('mysql')">
                        <div class="category-info">
                            <div class="category-icon"><img src="/Icons/databases/10122-icon-service-Azure-Database-MySQL-Server.svg" alt="MySQL"></div>
                            <div class="category-name">MySQL Servers</div>
                        </div>
                        <div class="category-toggle">‚ñº</div>
                    </div>
                    <div class="category-prompts" id="category-mysql">
                        <div class="prompt-item" onclick="quickPrompt('List ALL Azure Database for MySQL servers in my subscription. Include: Server Name, Resource Group, Location, Version, SKU/Tier, vCores, Storage GB, Status.')">
                            <span class="prompt-icon">üìã</span>
                            <span>List MySQL servers</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show MySQL servers with public network access. Include: Server Name, Resource Group, Public Access Status, Firewall Rules, Private Endpoint Status, SSL Mode, Risk Level.')">
                            <span class="prompt-icon">üîì</span>
                            <span>MySQL public access</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show MySQL servers performance and utilization. Include: Server Name, CPU Utilization %, Memory Utilization %, Storage Utilization %, Active Connections, Recommendation.')">
                            <span class="prompt-icon">‚ö°</span>
                            <span>MySQL performance</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show MySQL servers backup configuration. Include: Server Name, Backup Retention Days, Geo-Redundant Backup, Last Backup Time, Recommendation.')">
                            <span class="prompt-icon">üíæ</span>
                            <span>MySQL backup status</span>
                        </div>
                    </div>
                </div>

                <!-- Cosmos DB Category -->
                <div class="category-section">
                    <div class="category-header" onclick="toggleCategory('cosmosdb')">
                        <div class="category-info">
                            <div class="category-icon"><img src="/Icons/databases/10121-icon-service-Azure-Cosmos-DB.svg" alt="Cosmos DB"></div>
                            <div class="category-name">Cosmos DB</div>
                        </div>
                        <div class="category-toggle">‚ñº</div>
                    </div>
                    <div class="category-prompts" id="category-cosmosdb">
                        <div class="prompt-item" onclick="quickPrompt('List ALL Cosmos DB accounts in my subscription. Include: Account Name, Resource Group, Location, API Type (SQL/MongoDB/Cassandra/Gremlin/Table), Consistency Level, Replication Regions, Status.')">
                            <span class="prompt-icon">üìã</span>
                            <span>List Cosmos DB accounts</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show Cosmos DB accounts with public network access. Include: Account Name, Resource Group, Public Access Status, Firewall Rules, Private Endpoint Status, VNet Filter, Risk Level.')">
                            <span class="prompt-icon">üîì</span>
                            <span>Cosmos DB public access</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show Cosmos DB RU/s utilization and cost optimization opportunities. Include: Account Name, Database, Container, Provisioned RU/s, Used RU/s, Utilization %, Autoscale Status, Cost Optimization Recommendation.')">
                            <span class="prompt-icon">üí∞</span>
                            <span>Cosmos DB RU optimization</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show Cosmos DB replication and backup configuration. Include: Account Name, Write Regions, Read Regions, Automatic Failover, Backup Type, Retention Period.')">
                            <span class="prompt-icon">üîÑ</span>
                            <span>Cosmos DB replication</span>
                        </div>
                    </div>
                </div>

                <!-- Storage Accounts Category -->
                <div class="category-section">
                    <div class="category-header" onclick="toggleCategory('storage')">
                        <div class="category-info">
                            <div class="category-icon"><img src="/Icons/storage/10086-icon-service-Storage-Accounts.svg" alt="Storage"></div>
                            <div class="category-name">Storage Accounts</div>
                        </div>
                        <div class="category-toggle">‚ñº</div>
                    </div>
                    <div class="category-prompts" id="category-storage">
                        <div class="prompt-item" onclick="quickPrompt('List ALL Storage Accounts in my subscription. Include: Storage Account Name, Resource Group, Location, SKU/Tier, Kind (StorageV2/BlobStorage/etc), Status, Access Tier, Replication Type, Creation Date, Tags.')">
                            <span class="prompt-icon">üìã</span>
                            <span>Storage account summary</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show Storage Accounts with PUBLIC ACCESS enabled (blob anonymous access). Include: Account Name, Resource Group, Location, Public Access Setting, Blob Public Access, Network Rule Default Action, Risk Level, Security Recommendation.')">
                            <span class="prompt-icon">üîì</span>
                            <span>Storage public access enabled</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show Storage Accounts with PRIVATE ENDPOINTS configured. Include: Account Name, Resource Group, Private Endpoint Name, Private IP, VNet, Subnet, Connection Status, Approval Status.')">
                            <span class="prompt-icon">üîê</span>
                            <span>Storage with private endpoints</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show EMPTY Storage Accounts with no blobs, files, tables, or queues. Include: Account Name, Resource Group, Location, Total Capacity, Container Count, File Share Count, Created Date, Recommendation.')">
                            <span class="prompt-icon">üì≠</span>
                            <span>Empty storage accounts</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show Storage Accounts NOT USED in the last 3 months (no transactions or changes). Include: Account Name, Resource Group, Last Activity Date, Last Transaction Date, Usage Pattern, Monthly Cost, Recommendation.')">
                            <span class="prompt-icon">üí§</span>
                            <span>Unused storage accounts</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show Storage Account capacity utilization sorted by size. Include: Account Name, Resource Group, Total Capacity (GB/TB), Blob Capacity, File Capacity, Table Capacity, Queue Capacity, Access Tier Distribution, Cost Estimate.')">
                            <span class="prompt-icon">üìä</span>
                            <span>Storage capacity wise</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('List ALL Azure File Shares across storage accounts. Include: File Share Name, Storage Account, Resource Group, Quota (GB), Used Capacity (GB), Protocol (SMB/NFS), Access Tier, Snapshot Count.')">
                            <span class="prompt-icon">üìÅ</span>
                            <span>File Shares inventory</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show File Shares configured with Active Directory authentication. Include: File Share Name, Storage Account, AD Join Status, Domain Name, Authentication Type (AD DS/Azure AD DS/Kerberos), RBAC Enabled, Permission Configuration.')">
                            <span class="prompt-icon">üîë</span>
                            <span>File Shares with AD auth</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show Storage Accounts with Lifecycle Management policies configured. Include: Account Name, Resource Group, Policy Count, Rules Summary (Tier Down/Delete after X days), Affected Containers, Estimated Savings.')">
                            <span class="prompt-icon">‚ôªÔ∏è</span>
                            <span>Lifecycle management policies</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show Storage Account cost optimization opportunities. Include: Account Name, Resource Group, Current Tier, Monthly Cost, Optimization Type (Tier Change/Lifecycle Policy/Delete Unused), Recommended Action, Estimated Monthly Savings.')">
                            <span class="prompt-icon">üí∞</span>
                            <span>Storage cost optimization</span>
                        </div>
                    </div>
                </div>

                <!-- Entra ID (Azure AD) Category -->
                <div class="category-section">
                    <div class="category-header" onclick="toggleCategory('entraid')">
                        <div class="category-info">
                            <div class="category-icon"><img src="/Icons/identity/10235-icon-service-Identity-Governance.svg" alt="Entra ID"></div>
                            <div class="category-name">Entra ID (Azure AD)</div>
                        </div>
                        <div class="category-toggle">‚ñº</div>
                    </div>
                    <div class="category-prompts" id="category-entraid">
                        <div class="prompt-item" onclick="quickPrompt('Show Entra ID tenant overview. Include: Total Users, Guest Users, Groups, App Registrations, Enterprise Applications, Devices, Conditional Access Policies, License Summary.')">
                            <span class="prompt-icon">üìä</span>
                            <span>Entra ID overview</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show users who have not signed in for 30+ days. Include: User Name, Email, User Principal Name, Last Sign-in Date, Days Since Sign-in, Account Status, User Type, Department.')">
                            <span class="prompt-icon">‚è∞</span>
                            <span>Users inactive 30+ days</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show orphaned guest accounts that haven\\'t signed in for 90+ days. Include: Guest Name, Email, Invited By, Invitation Date, Last Sign-in, Days Inactive, Access Level, Cleanup Recommendation.')">
                            <span class="prompt-icon">üëª</span>
                            <span>Orphaned guest accounts</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show users with privileged directory roles (Global Admin, Security Admin, etc.). Include: User Name, Email, Role Assignments, Role Type (Built-in/Custom), PIM Eligible, MFA Status, Last Sign-in.')">
                            <span class="prompt-icon">üëë</span>
                            <span>Privileged role users</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show all Global Administrators in Entra ID. Include: User Name, Email, Account Type (Member/Guest), MFA Enabled, Last Sign-in, PIM Status, Risk Level.')">
                            <span class="prompt-icon">üîë</span>
                            <span>Global administrators</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show all devices registered in Entra ID. Include: Device Name, Device Type (Windows/iOS/Android/macOS), OS Version, Compliance State, Trust Type (Azure AD Joined/Hybrid/Registered), Last Activity.')">
                            <span class="prompt-icon">üíª</span>
                            <span>Device inventory</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show stale devices not active in 90+ days. Include: Device Name, Device Type, OS, Last Activity Date, Days Inactive, Compliance State, Owner, Cleanup Recommendation.')">
                            <span class="prompt-icon">üìµ</span>
                            <span>Stale devices (90+ days)</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show all app registrations in Entra ID. Include: App Name, Application ID, Publisher, Verified, Created Date, Credential Expiry, API Permissions, Sign-in Audience.')">
                            <span class="prompt-icon">üì±</span>
                            <span>App registrations</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show enterprise applications (service principals). Include: App Name, Publisher, Application ID, Sign-in Enabled, User Assignment Required, Last Sign-in, Users/Groups Assigned.')">
                            <span class="prompt-icon">üè¢</span>
                            <span>Enterprise applications</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show all groups in Entra ID. Include: Group Name, Group Type (Security/M365/Distribution), Membership Type (Assigned/Dynamic), Member Count, Owner, Created Date, Description.')">
                            <span class="prompt-icon">üë•</span>
                            <span>Groups inventory</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show empty groups with no members. Include: Group Name, Group Type, Created Date, Owner, Description, Cleanup Recommendation.')">
                            <span class="prompt-icon">üì≠</span>
                            <span>Empty groups</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show all Conditional Access policies. Include: Policy Name, State (Enabled/Disabled/Report-only), Target Users/Groups, Cloud Apps, Conditions, Grant Controls (MFA/Block/etc), Session Controls.')">
                            <span class="prompt-icon">üõ°Ô∏è</span>
                            <span>Conditional Access policies</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show disabled Conditional Access policies. Include: Policy Name, Created Date, Modified Date, Target Scope, Original Purpose, Disable Reason, Security Impact.')">
                            <span class="prompt-icon">‚ö†Ô∏è</span>
                            <span>Disabled CA policies</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show Conditional Access policies that do NOT require MFA. Include: Policy Name, State, Target Users, Cloud Apps, Grant Controls, Risk Level, MFA Recommendation.')">
                            <span class="prompt-icon">üö®</span>
                            <span>CA policies without MFA</span>
                        </div>
                    </div>
                </div>

                <!-- Access Control (IAM) Category -->
                <div class="category-section">
                    <div class="category-header" onclick="toggleCategory('iam')">
                        <div class="category-info">
                            <div class="category-icon"><img src="/Icons/identity/10340-icon-service-Entra-Identity-Roles-and-Administrators.svg" alt="IAM"></div>
                            <div class="category-name">Access Control (IAM)</div>
                        </div>
                        <div class="category-toggle">‚ñº</div>
                    </div>
                    <div class="category-prompts" id="category-iam">
                        <div class="prompt-item" onclick="quickPrompt('List ALL Active (Permanent) role assignments at Management Group level. These are always-on privileged access assignments that pose security risk. Include: Principal Name, Principal Type (User/Group/ServicePrincipal), Role Name, Role Type (BuiltIn/Custom), Scope (Management Group Name), Assignment Type (Active/Eligible), Created Date, Created By. Focus on privileged roles: Owner, Contributor, User Access Administrator. Flag any concerning patterns.')">
                            <span class="prompt-icon">üè¢</span>
                            <span>Active roles at Management Group</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('List ALL Active (Permanent) role assignments at Subscription level. Show assignments that are always active (not PIM eligible). Include: Principal Name, Principal Type (User/Group/ServicePrincipal), Role Name, Scope (Subscription Name), Assignment Type, Created Date, Risk Level. Highlight Owner, Contributor, and User Access Administrator roles. Sort by risk level.')">
                            <span class="prompt-icon">üìã</span>
                            <span>Active roles at Subscription</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('List ALL Active (Permanent) role assignments at Resource Group level. Show permanent privileged access that bypasses PIM. Include: Principal Name, Principal Type, Role Name, Resource Group, Subscription, Assignment Type, Created Date. Flag privileged roles (Owner, Contributor, User Access Administrator) as security concerns.')">
                            <span class="prompt-icon">üìÅ</span>
                            <span>Active roles at Resource Group</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('List ALL Privileged Administrator roles assigned to GUEST users across all scopes. This is a critical security audit. Include: Guest User Email, Guest Domain, Role Name, Scope Level (Management Group/Subscription/Resource Group), Scope Name, Assignment Type (Active/Eligible), Invitation Date, Last Sign-in Date, Risk Level. Flag roles: Global Administrator, Owner, Contributor, User Access Administrator, Security Admin.')">
                            <span class="prompt-icon">‚ö†Ô∏è</span>
                            <span>Privileged roles on Guest users</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show comprehensive RBAC role assignment summary across all scopes. Include: Total Assignments by Scope (Management Group/Subscription/Resource Group), Breakdown by Principal Type (Users/Groups/Service Principals), Breakdown by Role Type (Owner/Contributor/Reader/Custom), Active vs Eligible (PIM) assignments, Guest user role counts, Security risk summary.')">
                            <span class="prompt-icon">üìä</span>
                            <span>RBAC summary dashboard</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('List Service Principals and Managed Identities with Owner or Contributor roles. Include: Service Principal Name, Application ID, Type (App Registration/Managed Identity), Role Name, Scope, Created Date, Last Activity, Associated Resources. These can be security risks if compromised.')">
                            <span class="prompt-icon">ü§ñ</span>
                            <span>Service Principal privileged roles</span>
                        </div>
                    </div>
                </div>

                <!-- Well-Architected Framework (WAF) Category -->
                <div class="category-section">
                    <div class="category-header" onclick="toggleCategory('waf')">
                        <div class="category-info">
                            <div class="category-icon"><img src="/Icons/management + governance/00003-icon-service-Advisor.svg" alt="WAF"></div>
                            <div class="category-name">Well-Architected Framework</div>
                        </div>
                        <div class="category-toggle">‚ñº</div>
                    </div>
                    <div class="category-prompts" id="category-waf">
                        <!-- WAF Overview -->
                        <div class="prompt-item" onclick="quickPrompt('Perform a comprehensive Azure Well-Architected Framework (WAF) assessment based on Microsoft official guidance (https://learn.microsoft.com/azure/well-architected/). Analyze resources in the current context against all 5 pillars: Reliability, Security, Cost Optimization, Operational Excellence, and Performance Efficiency. For each pillar provide: 1) Current state assessment, 2) Identified gaps against WAF best practices, 3) Risk level (Critical/High/Medium/Low), 4) Top 3 prioritized recommendations with WAF documentation references. Include a summary scorecard and quick wins.')">
                            <span class="prompt-icon"><img src="/Icons/management + governance/00003-icon-service-Advisor.svg" alt="WAF" style="width:18px;height:18px;"></span>
                            <span>Full WAF Assessment</span>
                        </div>
                        
                        <!-- Reliability Pillar -->
                        <div class="prompt-item" onclick="quickPrompt('Perform a WAF RELIABILITY pillar assessment per Microsoft guidance (https://learn.microsoft.com/azure/well-architected/reliability/). Focus on: DESIGN FOR RESILIENCE: 1) VMs without Availability Zones/Sets - check fault domain distribution, 2) Single points of failure - identify resources lacking redundancy, 3) Load balancer health probes and backend pool configuration. DESIGN FOR RECOVERY: 4) Backup coverage - VMs, disks, databases without Azure Backup, 5) Recovery Services Vault configuration and RPO/RTO targets, 6) Disaster recovery - geo-replication for SQL, storage GRS/ZRS vs LRS. DESIGN FOR OPERATIONS: 7) Health modeling - resources without diagnostic settings. Rate each finding by impact and provide WAF-aligned remediation.')">
                            <span class="prompt-icon"><img src="/Icons/general/10004-icon-service-Service-Health.svg" alt="Reliability" style="width:18px;height:18px;"></span>
                            <span>Reliability Assessment</span>
                        </div>
                        
                        <!-- Security Pillar -->
                        <div class="prompt-item" onclick="quickPrompt('Perform a WAF SECURITY pillar assessment per Microsoft guidance (https://learn.microsoft.com/azure/well-architected/security/). Focus on: PROTECT CONFIDENTIALITY: 1) Storage accounts with public blob access enabled, 2) Key Vaults without soft-delete/purge protection, 3) Databases without encryption (TDE). PROTECT INTEGRITY: 4) NSGs with overly permissive rules (0.0.0.0/0 inbound), 5) Resources without Private Endpoints exposing public IPs. IDENTITY & ACCESS: 6) Privileged RBAC - Owner/Contributor at subscription level, 7) Service principals with excessive permissions, 8) Guest users with privileged roles. SUSTAIN SECURITY POSTURE: 9) Microsoft Defender for Cloud recommendations, 10) Policy compliance for security initiatives. Rate by severity and provide WAF security recommendations.')">
                            <span class="prompt-icon"><img src="/Icons/security/10241-icon-service-Microsoft-Defender-for-Cloud.svg" alt="Security" style="width:18px;height:18px;"></span>
                            <span>Security Assessment</span>
                        </div>
                        
                        <!-- Cost Optimization Pillar -->
                        <div class="prompt-item" onclick="quickPrompt('Perform a WAF COST OPTIMIZATION pillar assessment per Microsoft guidance (https://learn.microsoft.com/azure/well-architected/cost-optimization/). Focus on: COST MANAGEMENT DISCIPLINE: 1) Resources without cost allocation tags (CostCenter, Owner, Environment), 2) Budget alerts and spending anomalies. DESIGN FOR USAGE OPTIMIZATION: 3) Deallocated VMs still incurring storage costs, 4) Orphaned/unattached disks, 5) Unattached Public IP addresses, 6) Idle resources with low utilization. DESIGN FOR RATE OPTIMIZATION: 7) Resources suitable for Reserved Instances or Savings Plans, 8) Dev/Test workloads on production pricing, 9) Over-provisioned VM sizes (rightsizing opportunities). MONITOR AND OPTIMIZE: 10) Storage tier optimization (hot data on cool/archive tiers). Provide estimated monthly savings for each recommendation.')">
                            <span class="prompt-icon"><img src="/Icons/general/10019-icon-service-Cost-Management.svg" alt="Cost" style="width:18px;height:18px;"></span>
                            <span>Cost Optimization Assessment</span>
                        </div>
                        
                        <!-- Operational Excellence Pillar -->
                        <div class="prompt-item" onclick="quickPrompt('Perform a WAF OPERATIONAL EXCELLENCE pillar assessment per Microsoft guidance (https://learn.microsoft.com/azure/well-architected/operational-excellence/). Focus on: ESTABLISH STANDARDS: 1) Naming convention compliance - check for consistent naming patterns, 2) Tagging standards - missing required tags (Environment, Owner, Application), 3) Policy compliance status and violations. EVOLVE WITH OBSERVABILITY: 4) Resources without diagnostic settings enabled, 5) VMs without Azure Monitor agent, 6) Missing Activity Log alerts for critical operations. AUTOMATE FOR EFFICIENCY: 7) Automation accounts and runbook coverage, 8) Update Management compliance for VMs. DEPLOY WITH CONFIDENCE: 9) Resources without resource locks (CanNotDelete/ReadOnly), 10) Infrastructure as Code coverage. Provide governance improvement recommendations aligned with WAF.')">
                            <span class="prompt-icon"><img src="/Icons/management + governance/00001-icon-service-Monitor.svg" alt="OpEx" style="width:18px;height:18px;"></span>
                            <span>Operational Excellence Assessment</span>
                        </div>
                        
                        <!-- Performance Efficiency Pillar -->
                        <div class="prompt-item" onclick="quickPrompt('Perform a WAF PERFORMANCE EFFICIENCY pillar assessment per Microsoft guidance (https://learn.microsoft.com/azure/well-architected/performance-efficiency/). Focus on: MEET CAPACITY REQUIREMENTS: 1) VM SKU appropriateness - burstable B-series for variable workloads, 2) App Service plans without auto-scaling rules, 3) SQL databases DTU/vCore sizing analysis. ACHIEVE AND SUSTAIN PERFORMANCE: 4) Disk type optimization - Standard HDD where Premium SSD needed, 5) Storage account performance tier vs access patterns, 6) Network latency - resources spread across regions without optimization. IMPROVE THROUGH OPTIMIZATION: 7) CDN coverage for static content, 8) Caching implementations (Redis Cache usage), 9) Database query performance indicators. Provide right-sizing and performance tuning recommendations with expected improvements.')">
                            <span class="prompt-icon"><img src="/Icons/devops/02423-icon-service-Load-Testing.svg" alt="Perf" style="width:18px;height:18px;"></span>
                            <span>Performance Efficiency Assessment</span>
                        </div>
                        
                        <!-- WAF by Resource Group -->
                        <div class="prompt-item" onclick="quickPrompt('Perform a targeted WAF review for a specific resource group based on Microsoft Well-Architected Framework. Ask me which resource group to analyze, then assess all resources in that group against the 5 WAF pillars: Reliability (resilience, recovery), Security (confidentiality, integrity, access), Cost Optimization (usage, rate optimization), Operational Excellence (observability, automation), Performance Efficiency (capacity, optimization). This provides a workload-specific assessment with actionable recommendations.')">
                            <span class="prompt-icon">üìÅ</span>
                            <span>WAF Review by Resource Group</span>
                        </div>
                        
                        <!-- WAF by Tag -->
                        <div class="prompt-item" onclick="quickPrompt('Perform a WAF review for resources filtered by tag based on Microsoft Well-Architected Framework. Ask me which tag (name and value) to filter by (e.g., Application=MyApp, Environment=Production), then analyze those tagged resources against all 5 WAF pillars. This enables application-level or workload-level WAF assessment across resource groups, providing recommendations specific to that logical grouping.')">
                            <span class="prompt-icon">üè∑Ô∏è</span>
                            <span>WAF Review by Tag</span>
                        </div>
                    </div>
                </div>

                <!-- Orphaned Resources Category -->
                <!-- Based on: https://github.com/dolevshor/azure-orphan-resources -->
                <div class="category-section">
                    <div class="category-header" onclick="toggleCategory('orphaned')">
                        <div class="category-info">
                            <div class="category-icon"><img src="/Icons/general/10318-icon-service-Resource-Graph-Explorer.svg" alt="Orphaned"></div>
                            <div class="category-name">Orphaned Resources</div>
                        </div>
                        <div class="category-toggle">‚ñº</div>
                    </div>
                    <div class="category-prompts" id="category-orphaned">
                        <!-- Summary -->
                        <div class="prompt-item" onclick="quickPrompt('Get a COMPLETE summary of ALL orphaned resources in my environment. Show count by category: App Service Plans (no apps), Availability Sets (no VMs), Managed Disks (unattached), SQL Elastic Pools (no databases), Public IPs (unattached), Network Interfaces (not attached), NSGs (not attached), Route Tables (not attached), Load Balancers (no backends), Application Gateways (no targets), NAT Gateways (not attached), Private DNS Zones (no VNet links), Private Endpoints (disconnected), VNet Gateways (no connections), DDoS Protection (no VNets), Empty Resource Groups. Highlight resources with cost impact (üí≤) and calculate total potential monthly savings.')">
                            <span class="prompt-icon"><img src="/Icons/general/10001-icon-service-All-Resources.svg" alt="Summary" style="width:18px;height:18px;"></span>
                            <span>Full Orphaned Resources Summary</span>
                        </div>
                        
                        <!-- COMPUTE -->
                        <div class="prompt-item" onclick="quickPrompt('Find orphaned App Service Plans - plans without any hosted web apps or functions. üí≤ These cost money even when empty. Include: Plan Name, Resource Group, Location, SKU/Tier, Number of Sites (should be 0), Monthly Cost Estimate, Tags. Recommend deletion or consolidation.')">
                            <span class="prompt-icon"><img src="/Icons/compute/10035-icon-service-App-Services.svg" alt="App Service" style="width:18px;height:18px;"></span>
                            <span>App Service Plans (no apps) üí≤</span>
                        </div>
                        
                        <div class="prompt-item" onclick="quickPrompt('Find orphaned Availability Sets - sets not associated to any Virtual Machine or VMSS. Excludes Azure Site Recovery (ASR) sets. Include: Availability Set Name, Resource Group, Location, Fault Domains, Update Domains, VM Count (should be 0), Tags. These can be safely deleted.')">
                            <span class="prompt-icon"><img src="/Icons/compute/10034-icon-service-Availability-Sets.svg" alt="Availability Set" style="width:18px;height:18px;"></span>
                            <span>Availability Sets (no VMs)</span>
                        </div>
                        
                        <!-- STORAGE -->
                        <div class="prompt-item" onclick="quickPrompt('Find orphaned Managed Disks in Unattached state. üí≤ These disks cost money even when not attached to any VM. Excludes ASR replica disks and AKS PVC disks. Include: Disk Name, Resource Group, Location, Disk Type (Premium/Standard), Size GB, Disk State, Time Created, Monthly Cost Estimate, Tags. Sort by size descending to prioritize largest savings.')">
                            <span class="prompt-icon"><img src="/Icons/compute/10032-icon-service-Disks.svg" alt="Disk" style="width:18px;height:18px;"></span>
                            <span>Managed Disks (unattached) üí≤</span>
                        </div>
                        
                        <!-- DATABASE -->
                        <div class="prompt-item" onclick="quickPrompt('Find orphaned SQL Elastic Pools without any databases. üí≤ These pools cost money even when empty. Include: Pool Name, SQL Server Name, Resource Group, Location, DTU/vCore Config, Database Count (should be 0), Monthly Cost Estimate, Tags. Recommend deletion or database migration.')">
                            <span class="prompt-icon"><img src="/Icons/databases/10137-icon-service-SQL-Elastic-Pools.svg" alt="SQL Pool" style="width:18px;height:18px;"></span>
                            <span>SQL Elastic Pools (empty) üí≤</span>
                        </div>
                        
                        <!-- NETWORKING -->
                        <div class="prompt-item" onclick="quickPrompt('Find orphaned Public IP addresses not attached to any resource (VM, Load Balancer, NAT Gateway, Application Gateway, etc.). üí≤ Static Public IPs cost money even when unattached. Include: IP Name, Resource Group, Location, SKU Type, Allocation Method, IP Address (if assigned), Monthly Cost Estimate, Tags.')">
                            <span class="prompt-icon"><img src="/Icons/networking/10069-icon-service-Public-IP-Addresses.svg" alt="Public IP" style="width:18px;height:18px;"></span>
                            <span>Public IPs (unattached) üí≤</span>
                        </div>
                        
                        <div class="prompt-item" onclick="quickPrompt('Find orphaned Network Interfaces not attached to any VM or other resource. Excludes Azure NetApp Volumes NICs. Include: NIC Name, Resource Group, Location, Private IP Address, Attached Resource (should be empty), Tags. These can be safely deleted.')">
                            <span class="prompt-icon"><img src="/Icons/networking/10080-icon-service-Network-Interfaces.svg" alt="NIC" style="width:18px;height:18px;"></span>
                            <span>Network Interfaces (not attached)</span>
                        </div>
                        
                        <div class="prompt-item" onclick="quickPrompt('Find orphaned Network Security Groups not attached to any NIC or subnet. Include: NSG Name, Resource Group, Location, Rule Count, Attached NICs (should be 0), Attached Subnets (should be 0), Tags. Review before deletion as they may contain custom rules worth preserving.')">
                            <span class="prompt-icon"><img src="/Icons/networking/10067-icon-service-Network-Security-Groups.svg" alt="NSG" style="width:18px;height:18px;"></span>
                            <span>NSGs (not attached)</span>
                        </div>
                        
                        <div class="prompt-item" onclick="quickPrompt('Find orphaned Route Tables not attached to any subnet. Include: Route Table Name, Resource Group, Location, Route Count, Attached Subnets (should be 0), BGP Route Propagation setting, Tags. Review custom routes before deletion.')">
                            <span class="prompt-icon"><img src="/Icons/networking/10082-icon-service-Route-Tables.svg" alt="Route Table" style="width:18px;height:18px;"></span>
                            <span>Route Tables (not attached)</span>
                        </div>
                        
                        <div class="prompt-item" onclick="quickPrompt('Find orphaned Load Balancers without backend pools or NAT rules. üí≤ Load Balancers cost money even when not routing traffic. Include: LB Name, Resource Group, Location, SKU Type, Backend Pool Count (should be 0), NAT Rule Count (should be 0), Monthly Cost Estimate, Tags.')">
                            <span class="prompt-icon"><img src="/Icons/networking/10062-icon-service-Load-Balancers.svg" alt="Load Balancer" style="width:18px;height:18px;"></span>
                            <span>Load Balancers (no backends) üí≤</span>
                        </div>
                        
                        <div class="prompt-item" onclick="quickPrompt('Find orphaned Application Gateways without backend targets. üí≤ Application Gateways are expensive even when not routing traffic. Include: AppGw Name, Resource Group, Location, SKU Tier, Capacity, Backend IP Count (should be 0), Monthly Cost Estimate, Tags.')">
                            <span class="prompt-icon"><img src="/Icons/networking/10076-icon-service-Application-Gateways.svg" alt="App Gateway" style="width:18px;height:18px;"></span>
                            <span>Application Gateways (no targets) üí≤</span>
                        </div>
                        
                        <div class="prompt-item" onclick="quickPrompt('Find orphaned NAT Gateways not attached to any subnet. üí≤ NAT Gateways cost money even when not routing traffic. Include: NAT Gateway Name, Resource Group, Location, SKU, Idle Timeout, Attached Subnets (should be 0), Monthly Cost Estimate, Tags.')">
                            <span class="prompt-icon"><img src="/Icons/networking/10310-icon-service-NAT-Gateways.svg" alt="NAT Gateway" style="width:18px;height:18px;"></span>
                            <span>NAT Gateways (not attached) üí≤</span>
                        </div>
                        
                        <div class="prompt-item" onclick="quickPrompt('Find orphaned Virtual Network Gateways without Point-to-Site configuration or VPN connections. üí≤ VNet Gateways are expensive even when not routing traffic. Include: Gateway Name, Resource Group, Location, Gateway Type (VPN/ExpressRoute), SKU, Tier, Connection Count (should be 0), Monthly Cost Estimate, Tags.')">
                            <span class="prompt-icon"><img src="/Icons/networking/10063-icon-service-Virtual-Network-Gateways.svg" alt="VNet Gateway" style="width:18px;height:18px;"></span>
                            <span>VNet Gateways (no connections) üí≤</span>
                        </div>
                        
                        <div class="prompt-item" onclick="quickPrompt('Find orphaned Private DNS Zones without Virtual Network Links. üí≤ Private DNS Zones cost money even when not linked to any VNet. Include: Zone Name, Resource Group, Location, Record Set Count, VNet Links (should be 0), Monthly Cost Estimate, Tags.')">
                            <span class="prompt-icon"><img src="/Icons/networking/10064-icon-service-Private-DNS-Zones.svg" alt="Private DNS" style="width:18px;height:18px;"></span>
                            <span>Private DNS Zones (no links) üí≤</span>
                        </div>
                        
                        <div class="prompt-item" onclick="quickPrompt('Find orphaned Private Endpoints in Disconnected state. üí≤ Private Endpoints cost money even when disconnected from target service. Include: Endpoint Name, Resource Group, Location, Target Service, Connection State (should be Disconnected), Subnet, Monthly Cost Estimate, Tags.')">
                            <span class="prompt-icon"><img src="/Icons/networking/02579-icon-service-Private-Endpoints.svg" alt="Private Endpoint" style="width:18px;height:18px;"></span>
                            <span>Private Endpoints (disconnected) üí≤</span>
                        </div>
                        
                        <div class="prompt-item" onclick="quickPrompt('Find orphaned DDoS Protection Plans without any protected Virtual Networks. üí≤ DDoS Protection Plans are VERY expensive (~$2,944/month) even when not protecting any VNets. Include: Plan Name, Resource Group, Location, Protected VNets (should be 0), Monthly Cost, Tags. CRITICAL for cost savings.')">
                            <span class="prompt-icon"><img src="/Icons/networking/10072-icon-service-DDoS-Protection-Plans.svg" alt="DDoS" style="width:18px;height:18px;"></span>
                            <span>DDoS Protection Plans (unused) üí≤üí≤</span>
                        </div>
                        
                        <div class="prompt-item" onclick="quickPrompt('Find orphaned Virtual Networks without any subnets. Include: VNet Name, Resource Group, Location, Address Space, Subnet Count (should be 0), Tags. These are typically incomplete deployments.')">
                            <span class="prompt-icon"><img src="/Icons/networking/10061-icon-service-Virtual-Networks.svg" alt="VNet" style="width:18px;height:18px;"></span>
                            <span>Virtual Networks (no subnets)</span>
                        </div>
                        
                        <div class="prompt-item" onclick="quickPrompt('Find orphaned Subnets without connected devices or delegation (empty subnets). Include: Subnet Name, VNet Name, Resource Group, Address Prefix, Connected Devices (should be 0), Delegation (should be none), Tags. These may be reserved for future use.')">
                            <span class="prompt-icon"><img src="/Icons/networking/02743-icon-service-Subnet.svg" alt="Subnet" style="width:18px;height:18px;"></span>
                            <span>Empty Subnets</span>
                        </div>
                        
                        <div class="prompt-item" onclick="quickPrompt('Find orphaned IP Groups not attached to any Azure Firewall or Firewall Policy. Include: IP Group Name, Resource Group, Location, IP Address Count, Attached Firewalls (should be 0), Tags.')">
                            <span class="prompt-icon"><img src="/Icons/networking/00701-icon-service-IP-Groups.svg" alt="IP Group" style="width:18px;height:18px;"></span>
                            <span>IP Groups (not used)</span>
                        </div>
                        
                        <div class="prompt-item" onclick="quickPrompt('Find orphaned Front Door WAF Policies without Security Policy Links. Include: Policy Name, Resource Group, Location, SKU, Security Links (should be 0), Tags.')">
                            <span class="prompt-icon"><img src="/Icons/networking/10365-icon-service-Web-Application-Firewall-Policies-WAF.svg" alt="WAF Policy" style="width:18px;height:18px;"></span>
                            <span>Front Door WAF Policies (unused)</span>
                        </div>
                        
                        <div class="prompt-item" onclick="quickPrompt('Find orphaned Traffic Manager Profiles without any endpoints. Include: Profile Name, Resource Group, Routing Method, DNS Name, Endpoint Count (should be 0), Tags.')">
                            <span class="prompt-icon"><img src="/Icons/networking/10065-icon-service-Traffic-Manager-Profiles.svg" alt="Traffic Manager" style="width:18px;height:18px;"></span>
                            <span>Traffic Manager Profiles (no endpoints)</span>
                        </div>
                        
                        <!-- OTHERS -->
                        <div class="prompt-item" onclick="quickPrompt('Find empty Resource Groups without any resources. Include: Resource Group Name, Location, Subscription, Resource Count (should be 0), Tags. These are often leftover from deleted deployments.')">
                            <span class="prompt-icon"><img src="/Icons/general/10007-icon-service-Resource-Groups.svg" alt="Resource Group" style="width:18px;height:18px;"></span>
                            <span>Empty Resource Groups</span>
                        </div>
                        
                        <div class="prompt-item" onclick="quickPrompt('Find orphaned API Connections not used by any Logic App. Include: Connection Name, API Type, Resource Group, Location, Associated Logic Apps (should be none), Tags. These are often leftover from deleted Logic Apps.')">
                            <span class="prompt-icon"><img src="/Icons/integration/10201-icon-service-Logic-Apps.svg" alt="API Connection" style="width:18px;height:18px;"></span>
                            <span>API Connections (unused)</span>
                        </div>
                        
                        <div class="prompt-item" onclick="quickPrompt('Find expired App Service Certificates. Include: Certificate Name, Resource Group, Subject Name, Thumbprint, Expiration Date, Days Since Expiry, Tags. These need renewal or removal.')">
                            <span class="prompt-icon"><img src="/Icons/security/10245-icon-service-Key-Vaults.svg" alt="Certificate" style="width:18px;height:18px;"></span>
                            <span>Expired Certificates</span>
                        </div>
                    </div>
                </div>

                <!-- Azure Backup Category -->
                <div class="category-section">
                    <div class="category-header" onclick="toggleCategory('backup')">
                        <div class="category-info">
                            <div class="category-icon"><img src="/Icons/storage/00017-icon-service-Recovery-Services-Vaults.svg" alt="Backup"></div>
                            <div class="category-name">Azure Backup</div>
                        </div>
                        <div class="category-toggle">‚ñº</div>
                    </div>
                    <div class="category-prompts" id="category-backup">
                        <div class="prompt-item" onclick="quickPrompt('Show Virtual Machines ENABLED with Azure Backup. Include: VM Name, Resource Group, Location, Backup Vault, Policy Name, Last Backup Date, Backup Status, Recovery Points, Protection State.')">
                            <span class="prompt-icon">‚úÖ</span>
                            <span>VMs with backup enabled</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show Virtual Machines NOT ENABLED with Azure Backup. Include: VM Name, Resource Group, Location, OS Type, Power State, Created Date, Risk Level, Backup Recommendation.')">
                            <span class="prompt-icon">‚ö†Ô∏è</span>
                            <span>VMs without backup</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show Azure File Shares enabled for backup. Include: File Share Name, Storage Account, Resource Group, Backup Vault, Policy Name, Last Backup, Backup Status, Protected Size.')">
                            <span class="prompt-icon">üìÅ</span>
                            <span>File Shares with backup</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show Azure File Shares NOT enabled for backup. Include: File Share Name, Storage Account, Resource Group, Size, Protocol, Created Date, Risk Assessment, Backup Recommendation.')">
                            <span class="prompt-icon">üìÇ</span>
                            <span>File Shares without backup</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show Managed Disks enabled for backup using Backup Vault. Include: Disk Name, Resource Group, Disk Type, Size GB, Backup Vault, Policy, Last Backup Date, Backup Status.')">
                            <span class="prompt-icon">üíø</span>
                            <span>Managed Disks with backup</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show Managed Disks NOT enabled for Azure Backup. Include: Disk Name, Resource Group, Disk Type, Size GB, Attached VM, OS/Data Disk, Created Date, Backup Recommendation.')">
                            <span class="prompt-icon">üíΩ</span>
                            <span>Managed Disks without backup</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show Shared Disks (multi-attach enabled). Include: Disk Name, Resource Group, Disk Type, Size GB, Max Shares, Attached VMs, Location, Backup Considerations.')">
                            <span class="prompt-icon">üîó</span>
                            <span>Shared disks inventory</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show Storage Account Blobs enabled for backup. Include: Storage Account, Resource Group, Backup Vault, Containers Protected, Policy Name, Last Backup, Retention Days.')">
                            <span class="prompt-icon">üì¶</span>
                            <span>Blob backup status</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show Azure SQL Databases enabled for long-term backup retention. Include: Database Name, Server, Resource Group, Backup Type, Retention Policy, Last Backup, Recovery Point Oldest/Latest.')">
                            <span class="prompt-icon">üóÑÔ∏è</span>
                            <span>SQL databases backup status</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show SQL Managed Instances backup status. Include: Instance Name, Resource Group, Backup Type (Full/Diff/Log), Retention Days, Last Backup, Geo-Redundant Backup, Recovery Point Status.')">
                            <span class="prompt-icon">üèõÔ∏è</span>
                            <span>SQL MI backup status</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show summary of all Backup Vaults and Recovery Services Vaults. Include: Vault Name, Vault Type, Resource Group, Location, Protected Items Count, Backup Policies, Storage Redundancy, Soft Delete Enabled.')">
                            <span class="prompt-icon">üè¶</span>
                            <span>Backup vaults summary</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show failed backup jobs in the last 7 days. Include: Job ID, Protected Item, Vault, Job Type, Start Time, End Time, Error Code, Error Message, Retry Recommendation.')">
                            <span class="prompt-icon">‚ùå</span>
                            <span>Failed backup jobs</span>
                        </div>
                    </div>
                </div>

                <!-- API Management Category -->
                <div class="category-section">
                    <div class="category-header" onclick="toggleCategory('apim')">
                        <div class="category-info">
                            <div class="category-icon">üîå</div>
                            <div class="category-name">API Management</div>
                        </div>
                        <div class="category-toggle">‚ñº</div>
                    </div>
                    <div class="category-prompts" id="category-apim">
                        <div class="prompt-item" onclick="quickPrompt('List ALL API Management instances in my subscription. Include: APIM Name, Resource Group, Location, SKU/Tier, Capacity Units, Gateway URL, Status, VNet Mode.')">
                            <span class="prompt-icon">üìã</span>
                            <span>List APIM instances</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show APIM security configuration. Include: APIM Name, Authentication Methods, VNet Integration, Private Endpoint Status, Management Endpoint Access, Security Recommendations.')">
                            <span class="prompt-icon">üîê</span>
                            <span>APIM security config</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show APIM capacity utilization. Include: APIM Name, SKU, Current Capacity, CPU Utilization %, Memory Utilization %, Gateway Requests, Scaling Recommendation.')">
                            <span class="prompt-icon">üìà</span>
                            <span>APIM capacity utilization</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('Show APIM API inventory. Include: APIM Name, Total APIs, Total Operations, Products, Subscriptions, Top APIs by Usage.')">
                            <span class="prompt-icon">üìä</span>
                            <span>APIM API inventory</span>
                        </div>
                    </div>
                </div>

                <!-- About Category -->
                <div class="category-section">
                    <div class="category-header" onclick="toggleCategory('about')">
                        <div class="category-info">
                            <div class="category-icon"><img src="/Icons/general/10005-icon-service-Information.svg" alt="About"></div>
                            <div class="category-name">About</div>
                        </div>
                        <div class="category-toggle">‚ñº</div>
                    </div>
                    <div class="category-prompts" id="category-about">
                        <div class="prompt-item" onclick="showAboutModal()">
                            <span class="prompt-icon">üë§</span>
                            <span>About this solution</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('What features does the Azure CloudOps Intelligence Agent provide?')">
                            <span class="prompt-icon">‚ú®</span>
                            <span>Features list</span>
                        </div>
                        <div class="prompt-item" onclick="quickPrompt('How does this agent integrate with Azure services?')">
                            <span class="prompt-icon">üîó</span>
                            <span>Azure integration</span>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Chat Area -->
        <div class="chat-area">
            <div class="chat-messages" id="chatContainer">
                <div class="welcome-state">
                    <div class="welcome-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 23 23">
                            <rect width="11" height="11" fill="#F25022"/>
                            <rect x="12" width="11" height="11" fill="#7FBA00"/>
                            <rect y="12" width="11" height="11" fill="#00A4EF"/>
                            <rect x="12" y="12" width="11" height="11" fill="#FFB900"/>
                        </svg>
                    </div>
                    <h2>Welcome to Azure CloudOps Intelligence Agent</h2>
                    <p>Your intelligent assistant for comprehensive Azure infrastructure management. Manage resources, optimize costs, ensure security, monitor health, and explore Azure services. Select a category to get started or use the chat to ask questions.</p>
                    
                    <div class="welcome-categories">
                        <div class="welcome-category-card" onclick="showCategory('resources')">
                            <span class="welcome-category-icon"><img src="/Icons/general/10001-icon-service-All-Resources.svg" alt="Resources"></span>
                            <div class="welcome-category-title">Resource Management</div>
                            <div class="welcome-category-desc">Inventory, search, and filter Azure resources</div>
                            <div class="welcome-category-count">6 Quick Actions</div>
                        </div>
                        
                        <div class="welcome-category-card" onclick="showCategory('cost')">
                            <span class="welcome-category-icon"><img src="/Icons/general/10019-icon-service-Cost-Management.svg" alt="Cost"></span>
                            <div class="welcome-category-title">Cost Optimization</div>
                            <div class="welcome-category-desc">Cost analysis, comparisons, and savings opportunities</div>
                            <div class="welcome-category-count">7 Quick Actions</div>
                        </div>
                        
                        <div class="welcome-category-card" onclick="showCategory('security')">
                            <span class="welcome-category-icon"><img src="/Icons/security/10241-icon-service-Microsoft-Defender-for-Cloud.svg" alt="Security"></span>
                            <div class="welcome-category-title">Security & Compliance</div>
                            <div class="welcome-category-desc">Defender, Policy compliance, public access audit</div>
                            <div class="welcome-category-count">7 Quick Actions</div>
                        </div>
                        
                        <div class="welcome-category-card" onclick="showCategory('monitoring')">
                            <span class="welcome-category-icon"><img src="/Icons/management + governance/00001-icon-service-Monitor.svg" alt="Monitoring"></span>
                            <div class="welcome-category-title">Monitoring & Alerts</div>
                            <div class="welcome-category-desc">Alerts, monitoring gaps, VM Insights status</div>
                            <div class="welcome-category-count">11 Quick Actions</div>
                        </div>
                        
                        <div class="welcome-category-card" onclick="showCategory('sql')">
                            <span class="welcome-category-icon"><img src="/Icons/databases/10130-icon-service-SQL-Database.svg" alt="SQL"></span>
                            <div class="welcome-category-title">Azure SQL PaaS</div>
                            <div class="welcome-category-desc">SQL Database, Managed Instance optimization</div>
                            <div class="welcome-category-count">7 Quick Actions</div>
                        </div>
                        
                        <div class="welcome-category-card" onclick="showCategory('aks')">
                            <span class="welcome-category-icon"><img src="/Icons/compute/10023-icon-service-Kubernetes-Services.svg" alt="AKS"></span>
                            <div class="welcome-category-title">Azure Kubernetes</div>
                            <div class="welcome-category-desc">AKS clusters, monitoring, security posture</div>
                            <div class="welcome-category-count">5 Quick Actions</div>
                        </div>
                        
                        <div class="welcome-category-card" onclick="showCategory('appservices')">
                            <span class="welcome-category-icon"><img src="/Icons/compute/10035-icon-service-App-Services.svg" alt="App Services"></span>
                            <div class="welcome-category-title">App Services</div>
                            <div class="welcome-category-desc">Web apps, monitoring, public access</div>
                            <div class="welcome-category-count">5 Quick Actions</div>
                        </div>
                        
                        <div class="welcome-category-card" onclick="showCategory('updates')">
                            <span class="welcome-category-icon"><img src="/Icons/compute/00195-icon-service-Maintenance-Configuration.svg" alt="Updates"></span>
                            <div class="welcome-category-title">Update Management</div>
                            <div class="welcome-category-desc">VM and Arc machine patches and compliance</div>
                            <div class="welcome-category-count">6 Quick Actions</div>
                        </div>
                        
                        <div class="welcome-category-card" onclick="showCategory('policy')">
                            <span class="welcome-category-icon"><img src="/Icons/management + governance/10316-icon-service-Policy.svg" alt="Policy"></span>
                            <div class="welcome-category-title">Azure Policy</div>
                            <div class="welcome-category-desc">Policy compliance and exemptions</div>
                            <div class="welcome-category-count">5 Quick Actions</div>
                        </div>
                        
                        <div class="welcome-category-card" onclick="showCategory('tags')">
                            <span class="welcome-category-icon"><img src="/Icons/general/10014-icon-service-Tag.svg" alt="Tags"></span>
                            <div class="welcome-category-title">Tags Management</div>
                            <div class="welcome-category-desc">Tag inventory and compliance</div>
                            <div class="welcome-category-count">5 Quick Actions</div>
                        </div>
                        
                        <div class="welcome-category-card" onclick="showCategory('arc')">
                            <span class="welcome-category-icon"><img src="/Icons/management + governance/00756-icon-service-Azure-Arc.svg" alt="Arc"></span>
                            <div class="welcome-category-title">Azure Arc</div>
                            <div class="welcome-category-desc">Hybrid infrastructure management</div>
                            <div class="welcome-category-count">3 Quick Actions</div>
                        </div>
                        
                        <div class="welcome-category-card" onclick="showCategory('storage')">
                            <span class="welcome-category-icon"><img src="/Icons/storage/10086-icon-service-Storage-Accounts.svg" alt="Storage"></span>
                            <div class="welcome-category-title">Storage Accounts</div>
                            <div class="welcome-category-desc">Capacity, security, file shares, cost optimization</div>
                            <div class="welcome-category-count">10 Quick Actions</div>
                        </div>
                        
                        <div class="welcome-category-card" onclick="showCategory('entraid')">
                            <span class="welcome-category-icon"><img src="/Icons/identity/10235-icon-service-Identity-Governance.svg" alt="Entra ID"></span>
                            <div class="welcome-category-title">Entra ID (Azure AD)</div>
                            <div class="welcome-category-desc">Users, groups, apps, devices, conditional access</div>
                            <div class="welcome-category-count">14 Quick Actions</div>
                        </div>
                        
                        <div class="welcome-category-card" onclick="showCategory('iam')">
                            <span class="welcome-category-icon"><img src="/Icons/identity/10340-icon-service-Entra-Identity-Roles-and-Administrators.svg" alt="IAM"></span>
                            <div class="welcome-category-title">Access Control (IAM)</div>
                            <div class="welcome-category-desc">RBAC role assignments, privileged access audit</div>
                            <div class="welcome-category-count">6 Quick Actions</div>
                        </div>
                        
                        <div class="welcome-category-card" onclick="showCategory('waf')">
                            <span class="welcome-category-icon"><img src="/Icons/management + governance/00003-icon-service-Advisor.svg" alt="WAF"></span>
                            <div class="welcome-category-title">Well-Architected Framework</div>
                            <div class="welcome-category-desc">Reliability, Security, Cost, Operations, Performance</div>
                            <div class="welcome-category-count">8 Quick Actions</div>
                        </div>
                        
                        <div class="welcome-category-card" onclick="showCategory('backup')">
                            <span class="welcome-category-icon"><img src="/Icons/storage/00017-icon-service-Recovery-Services-Vaults.svg" alt="Backup"></span>
                            <div class="welcome-category-title">Azure Backup</div>
                            <div class="welcome-category-desc">VMs, disks, files, SQL backup protection status</div>
                            <div class="welcome-category-count">12 Quick Actions</div>
                        </div>
                        
                        <div class="welcome-category-card" onclick="showAboutModal()">
                            <span class="welcome-category-icon"><img src="/Icons/general/10005-icon-service-Information.svg" alt="About"></span>
                            <div class="welcome-category-title">About</div>
                            <div class="welcome-category-desc">About this solution and features</div>
                            <div class="welcome-category-count">Learn More</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="input-area">
                <div class="input-wrapper">
                    <textarea id="userInput" placeholder="Ask me anything about Azure infrastructure, costs, security, or optimization..." rows="1"></textarea>
                    <button id="sendBtn" onclick="sendMessage()">Send ‚úàÔ∏è</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let conversationHistory = [];

        // About Modal Functions
        function showAboutModal() {
            document.getElementById('aboutModal').classList.add('active');
        }

        function closeAboutModal(event) {
            if (!event || event.target === document.getElementById('aboutModal')) {
                document.getElementById('aboutModal').classList.remove('active');
            }
        }

        // Load user profile
        function loadUserProfile() {
            console.log('üîç Loading user profile...');
            
            let userInfo = sessionStorage.getItem('userInfo');
            if (!userInfo) {
                userInfo = localStorage.getItem('userInfo');
                if (userInfo) {
                    sessionStorage.setItem('userInfo', userInfo);
                }
            }
            
            if (userInfo) {
                try {
                    const user = JSON.parse(userInfo);
                    document.getElementById('userProfile').style.display = 'flex';
                    document.getElementById('userName').textContent = user.name || 'User';
                    document.getElementById('userEmail').textContent = user.email || '';
                    const initials = user.name ? user.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase() : 'U';
                    document.getElementById('userAvatar').textContent = initials;
                } catch (error) {
                    console.error('Error parsing user info:', error);
                }
            } else {
                const isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
                if (isLocal) {
                    const demoUser = { name: 'Demo User', email: 'demo@localhost', id: 'demo' };
                    sessionStorage.setItem('userInfo', JSON.stringify(demoUser));
                    document.getElementById('userProfile').style.display = 'flex';
                    document.getElementById('userName').textContent = demoUser.name;
                    document.getElementById('userEmail').textContent = demoUser.email;
                    document.getElementById('userAvatar').textContent = 'DU';
                } else {
                    window.location.replace('/login.html');
                }
            }
        }

        function logout() {
            sessionStorage.clear();
            localStorage.clear();
            window.location.replace('/login.html');
        }

        // Go to home/reload page
        function goHome() {
            window.location.reload();
        }

        // Subscription Management
        function changeSubscription() {
            const select = document.getElementById('subscriptionSelect');
            const selectedOption = select.options[select.selectedIndex];
            const subscriptionName = selectedOption.text;
            
            // Update insights based on subscription
            updateInsightsForSubscription(select.value);
            
            // Show notification
            showNotification(`Switched to ${subscriptionName} context`);
            
            // Clear conversation history when switching context
            conversationHistory = [];
            
            // Inform user about context switch
            const chatContainer = document.getElementById('chatContainer');
            if (!document.querySelector('.welcome-state')) {
                const contextMessage = document.createElement('div');
                contextMessage.className = 'context-switch-message';
                contextMessage.innerHTML = `
                    <div style="background: var(--surface-light); border: 1px solid var(--primary); border-radius: 12px; padding: 16px; margin: 16px auto; max-width: 600px; text-align: center;">
                        <strong style="color: var(--primary);">üìå Subscription Context Changed</strong><br>
                        <span style="color: var(--text-secondary); font-size: 13px;">Now showing data for: ${subscriptionName}</span>
                    </div>
                `;
                chatContainer.appendChild(contextMessage);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
        }

        async function updateInsightsForSubscription(subscriptionId) {
            console.log(`Loading stats for subscription: ${subscriptionId}`);
            const isAllSubs = subscriptionId === 'all' || subscriptionId === 'loading';
            
            try {
                const accessToken = sessionStorage.getItem('accessToken');
                const headers = { 'Content-Type': 'application/json' };
                if (accessToken) {
                    headers['Authorization'] = `Bearer ${accessToken}`;
                }

                // Update health score - default healthy
                document.getElementById('healthScore').textContent = '95%';
                
                // Fetch resource count - works for both single and all subscriptions
                try {
                    const resourcePrompt = isAllSubs 
                        ? 'How many total resources are across ALL my subscriptions? Just give me the total number.'
                        : 'How many total resources are in my current subscription? Just give me the number.';
                    
                    const resourceResponse = await fetch('/api/chat', {
                        method: 'POST',
                        headers: headers,
                        body: JSON.stringify({
                            message: resourcePrompt,
                            subscription_context: isAllSubs ? 'all' : subscriptionId,
                            all_subscriptions: isAllSubs
                        })
                    });
                    
                    if (resourceResponse.ok) {
                        const resourceData = await resourceResponse.json();
                        const countMatch = resourceData.response?.match(/\b(\d+)\b/);
                        if (countMatch) {
                            document.getElementById('resourceCount').textContent = countMatch[1];
                        }
                    }
                } catch (err) {
                    console.error('Error fetching resource count:', err);
                }

                // Fetch monthly cost - works for both single and all subscriptions
                try {
                    const costPrompt = isAllSubs
                        ? 'What is my total Azure cost for the current month across ALL subscriptions? Just give me the total amount in USD, format as $X,XXX.XX'
                        : 'What is my total Azure cost for the current month? Just give me the total amount in USD, format as $X,XXX.XX';
                    
                    const costResponse = await fetch('/api/chat', {
                        method: 'POST',
                        headers: headers,
                        body: JSON.stringify({
                            message: costPrompt,
                            subscription_context: isAllSubs ? 'all' : subscriptionId,
                            all_subscriptions: isAllSubs
                        })
                    });
                    
                    if (costResponse.ok) {
                        const costData = await costResponse.json();
                        // Extract dollar amount from response
                        const costMatch = costData.response?.match(/\$[\d,]+\.?\d*/);
                        if (costMatch) {
                            document.getElementById('monthlyCost').textContent = costMatch[0];
                        } else {
                            // Try to extract just a number if no $ sign
                            const numMatch = costData.response?.match(/[\d,]+\.?\d*\s*(USD|dollars?)?/i);
                            if (numMatch) {
                                document.getElementById('monthlyCost').textContent = '$' + numMatch[0].replace(/\s*(USD|dollars?)/i, '');
                            }
                        }
                    }
                } catch (err) {
                    console.error('Error fetching cost:', err);
                    document.getElementById('monthlyCost').textContent = '$--';
                }
                
            } catch (error) {
                console.error('Error loading stats:', error);
                // Keep default values on error
            }
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 90px;
                right: 20px;
                background: var(--primary);
                color: white;
                padding: 16px 24px;
                border-radius: 8px;
                box-shadow: var(--shadow-lg);
                z-index: 1000;
                animation: slideInRight 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Category Management
        function toggleCategory(categoryId) {
            const header = event.currentTarget;
            const prompts = document.getElementById(`category-${categoryId}`);
            
            header.classList.toggle('active');
            prompts.classList.toggle('active');
        }

        function showCategory(categoryId) {
            // Scroll to sidebar and open category
            const categoryHeader = document.querySelector(`#category-${categoryId}`).previousElementSibling;
            if (!categoryHeader.classList.contains('active')) {
                categoryHeader.click();
            }
            
            // Remove welcome state
            const welcomeState = document.querySelector('.welcome-state');
            if (welcomeState) {
                welcomeState.remove();
            }
        }

        function quickPrompt(prompt) {
            const welcomeState = document.querySelector('.welcome-state');
            if (welcomeState) {
                welcomeState.remove();
            }
            
            document.getElementById('userInput').value = prompt;
            sendMessage();
        }

        async function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            if (!message) return;

            const welcomeState = document.querySelector('.welcome-state');
            if (welcomeState) {
                welcomeState.remove();
            }

            addMessage(message, 'user');
            input.value = '';
            input.disabled = true;
            document.getElementById('sendBtn').disabled = true;
            document.getElementById('sendBtn').textContent = 'Thinking...';

            try {
                const userInfo = sessionStorage.getItem('userInfo');
                const user = userInfo ? JSON.parse(userInfo) : null;
                const accessToken = sessionStorage.getItem('accessToken');

                const headers = { 'Content-Type': 'application/json' };
                if (accessToken) {
                    headers['Authorization'] = `Bearer ${accessToken}`;
                }

                // Get current subscription context
                const subscriptionSelect = document.getElementById('subscriptionSelect');
                const selectedSubscription = subscriptionSelect.value;
                const subscriptionName = subscriptionSelect.options[subscriptionSelect.selectedIndex].text;
                
                // Check if user is asking for all subscriptions in their prompt
                const askingForAll = message.toLowerCase().includes('all subscription') || 
                                    message.toLowerCase().includes('across all') ||
                                    message.toLowerCase().includes('every subscription');
                
                // Determine if we're querying all subscriptions
                const isAllSubscriptions = selectedSubscription === 'all' || askingForAll;
                
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify({
                        message: message,
                        conversation_history: conversationHistory,
                        user_email: user?.email,
                        user_name: user?.name,
                        subscription_context: isAllSubscriptions ? 'all' : selectedSubscription,
                        subscription_name: isAllSubscriptions ? 'All Subscriptions' : subscriptionName,
                        all_subscriptions: isAllSubscriptions
                    })
                });

                const data = await response.json();
                addMessage(data.response, 'assistant');
                conversationHistory = data.conversation_history || [];

            } catch (error) {
                console.error('Error:', error);
                addMessage('Sorry, I encountered an error. Please try again.', 'assistant');
            } finally {
                input.disabled = false;
                document.getElementById('sendBtn').disabled = false;
                document.getElementById('sendBtn').textContent = 'Send ‚úàÔ∏è';
                input.focus();
            }
        }

        function addMessage(text, role) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;

            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = role === 'user' ? document.getElementById('userAvatar').textContent : 'ü§ñ';

            const content = document.createElement('div');
            content.className = 'message-content';
            
            // Convert markdown to HTML with proper table rendering
            let formattedText = text;
            
            // Convert markdown tables to HTML tables
            formattedText = convertMarkdownTablesToHTML(formattedText);
            
            // Convert bold markdown
            formattedText = formattedText.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            // Convert line breaks (only if not already in HTML table)
            if (!formattedText.includes('<table>')) {
                formattedText = formattedText.replace(/\n/g, '<br>');
            }
            
            content.innerHTML = formattedText;

            messageDiv.appendChild(avatar);
            messageDiv.appendChild(content);
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function convertMarkdownTablesToHTML(text) {
            const lines = text.split('\n');
            let inTable = false;
            let tableHTML = '';
            let result = '';
            let headers = [];
            let tableData = []; // Store table data for CSV export
            let tableId = 'table_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            
            // Look for export tag in the text: [EXPORT:query_id:ROWS:total_rows]
            let exportInfo = null;
            const exportMatch = text.match(/\[EXPORT:([a-zA-Z0-9-]+):ROWS:(\d+)\]/);
            if (exportMatch) {
                exportInfo = {
                    queryId: exportMatch[1],
                    totalRows: parseInt(exportMatch[2])
                };
                console.log('Found export info:', exportInfo);
            }
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                // Skip the export tag line
                if (line.match(/\[EXPORT:[a-zA-Z0-9-]+:ROWS:\d+\]/)) {
                    continue;
                }
                
                // Check if line is a table row
                if (line.startsWith('|') && line.endsWith('|')) {
                    // Skip separator lines (containing ---)
                    if (line.includes('---')) {
                        continue;
                    }
                    
                    const cells = line.split('|').filter(cell => cell.trim()).map(cell => cell.trim());
                    
                    if (!inTable) {
                        // Start new table
                        inTable = true;
                        headers = cells;
                        tableData = [headers]; // Initialize with headers
                        tableHTML = '<div class="table-wrapper"><table data-table-id="' + tableId + '"><thead><tr>';
                        cells.forEach(cell => {
                            tableHTML += `<th>${cell}</th>`;
                        });
                        tableHTML += '</tr></thead><tbody>';
                    } else {
                        // Add data row
                        tableData.push(cells); // Store raw data for CSV
                        tableHTML += '<tr>';
                        cells.forEach((cell, index) => {
                            // Highlight certain values
                            let cellContent = cell;
                            
                            // Check for cost/savings values
                            if (cell.match(/\$[\d,]+/) || cell.includes('USD')) {
                                cellContent = `<span class="cost-highlight">${cell}</span>`;
                            }
                            // Check for percentages
                            else if (cell.match(/\d+(\.\d+)?%/)) {
                                const percentage = parseFloat(cell);
                                if (percentage < 0) {
                                    cellContent = `<span class="savings-highlight">${cell}</span>`;
                                } else if (percentage > 80) {
                                    cellContent = `<span class="danger-highlight">${cell}</span>`;
                                }
                            }
                            // Check for status words
                            else if (cell.toLowerCase().includes('critical') || cell.toLowerCase().includes('high') || cell.toLowerCase().includes('danger')) {
                                cellContent = `<span class="danger-highlight">${cell}</span>`;
                            }
                            else if (cell.toLowerCase().includes('success') || cell.toLowerCase().includes('healthy') || cell.toLowerCase().includes('operational') || cell.toLowerCase().includes('compliant')) {
                                cellContent = `<span class="savings-highlight">${cell}</span>`;
                            }
                            else if (cell.toLowerCase().includes('warning') || cell.toLowerCase().includes('medium')) {
                                cellContent = `<span class="cost-highlight">${cell}</span>`;
                            }
                            
                            tableHTML += `<td>${cellContent}</td>`;
                        });
                        tableHTML += '</tr>';
                    }
                } else {
                    // Not a table line
                    if (inTable) {
                        // Close the table and add export button(s)
                        const rowCount = tableData.length - 1; // Exclude header row
                        tableHTML += '</tbody></table>';
                        tableHTML += '<div class="table-actions">';
                        
                        // Show row count with total if more data available
                        if (exportInfo && exportInfo.totalRows > rowCount) {
                            tableHTML += `<span class="row-count-badge">Showing ${rowCount} of ${exportInfo.totalRows} rows</span>`;
                        } else {
                            tableHTML += `<span class="row-count-badge">${rowCount} row${rowCount !== 1 ? 's' : ''}</span>`;
                        }
                        
                        // Display export button for visible data
                        tableHTML += `<button class="export-csv-btn" onclick='exportTableToCSV(${JSON.stringify(tableData)}, "azure_export")'>`;
                        tableHTML += '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>';
                        tableHTML += 'Export Visible';
                        tableHTML += '</button>';
                        
                        // Add "Download Full Report" button if more data available
                        if (exportInfo && exportInfo.totalRows > rowCount) {
                            tableHTML += `<button class="export-csv-btn full-export-btn" onclick='downloadFullReport("${exportInfo.queryId}", ${exportInfo.totalRows}, "azure_full_export")'>`;
                            tableHTML += '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>';
                            tableHTML += `Download All (${exportInfo.totalRows})`;
                            tableHTML += '</button>';
                        }
                        
                        tableHTML += '</div></div>';
                        result += tableHTML + '\n';
                        tableHTML = '';
                        inTable = false;
                        headers = [];
                        tableData = [];
                        tableId = 'table_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    }
                    
                    // Add regular line
                    if (line) {
                        result += line + '\n';
                    }
                }
            }
            
            // Close table if still open
            if (inTable) {
                const rowCount = tableData.length - 1;
                tableHTML += '</tbody></table>';
                tableHTML += '<div class="table-actions">';
                
                // Show row count with total if more data available
                if (exportInfo && exportInfo.totalRows > rowCount) {
                    tableHTML += `<span class="row-count-badge">Showing ${rowCount} of ${exportInfo.totalRows} rows</span>`;
                } else {
                    tableHTML += `<span class="row-count-badge">${rowCount} row${rowCount !== 1 ? 's' : ''}</span>`;
                }
                
                tableHTML += `<button class="export-csv-btn" onclick='exportTableToCSV(${JSON.stringify(tableData)}, "azure_export")'>`;
                tableHTML += '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>';
                tableHTML += 'Export Visible';
                tableHTML += '</button>';
                
                // Add "Download Full Report" button if more data available
                if (exportInfo && exportInfo.totalRows > rowCount) {
                    tableHTML += `<button class="export-csv-btn full-export-btn" onclick='downloadFullReport("${exportInfo.queryId}", ${exportInfo.totalRows}, "azure_full_export")'>`;
                    tableHTML += '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>';
                    tableHTML += `Download All (${exportInfo.totalRows})`;
                    tableHTML += '</button>';
                }
                
                tableHTML += '</div></div>';
                result += tableHTML;
            }
            
            return result;
        }

        // CSV Export Function (for displayed table data)
        function exportTableToCSV(tableData, filename) {
            if (!tableData || tableData.length === 0) {
                showNotification('No data to export');
                return;
            }
            
            // Generate timestamp for filename
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, 19);
            const fullFilename = `${filename}_${timestamp}.csv`;
            
            // Convert to CSV format
            const csvContent = tableData.map(row => {
                return row.map(cell => {
                    // Escape quotes and wrap in quotes if contains comma, quote, or newline
                    const cellStr = String(cell || '');
                    if (cellStr.includes(',') || cellStr.includes('"') || cellStr.includes('\n')) {
                        return '"' + cellStr.replace(/"/g, '""') + '"';
                    }
                    return cellStr;
                }).join(',');
            }).join('\n');
            
            // Add BOM for Excel UTF-8 compatibility
            const BOM = '\uFEFF';
            const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' });
            
            // Create download link
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', fullFilename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showNotification(`Exported ${tableData.length - 1} rows to ${fullFilename}`);
        }

        // Full Report Export Function (calls backend API for ALL data)
        async function downloadFullReport(queryId, totalRows, queryType) {
            try {
                showNotification(`Downloading full report (${totalRows} rows)...`);
                
                const response = await fetch(`/api/export-csv/${queryId}`);
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || 'Export failed');
                }
                
                // Get the blob from response
                const blob = await response.blob();
                
                // Get filename from header or generate one
                const contentDisposition = response.headers.get('Content-Disposition');
                let filename = `${queryType}_full_export.csv`;
                if (contentDisposition) {
                    const match = contentDisposition.match(/filename="(.+)"/);
                    if (match) filename = match[1];
                }
                
                // Create download link
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                showNotification(`Downloaded full report: ${totalRows} rows`);
            } catch (error) {
                console.error('Export error:', error);
                showNotification(`Export failed: ${error.message}`, 'error');
            }
        }

        // Event listeners
        document.getElementById('userInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Auto-resize textarea
        document.getElementById('userInput').addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 120) + 'px';
        });

        // Load Azure Subscriptions with Management Group Hierarchy
        async function loadAzureSubscriptions() {
            try {
                const accessToken = sessionStorage.getItem('accessToken');
                const headers = { 'Content-Type': 'application/json' };
                if (accessToken) {
                    headers['Authorization'] = `Bearer ${accessToken}`;
                }

                // Call backend to get subscriptions with hierarchy
                const response = await fetch('/api/subscriptions-hierarchy', {
                    method: 'GET',
                    headers: headers
                });

                const select = document.getElementById('subscriptionSelect');
                
                if (response.ok) {
                    const data = await response.json();
                    const subscriptions = data.subscriptions || [];
                    const managementGroups = data.managementGroups || [];
                    
                    // Clear loading option
                    select.innerHTML = '<option value="all">All Subscriptions</option>';
                    
                    // Add Management Groups section if available
                    if (managementGroups && managementGroups.length > 0) {
                        const mgOptGroup = document.createElement('optgroup');
                        mgOptGroup.label = 'üìÅ Management Groups';
                        
                        managementGroups.forEach(mg => {
                            const option = document.createElement('option');
                            option.value = `mg:${mg.id}`;
                            option.textContent = `üìÅ ${mg.name}`;
                            option.style.fontWeight = 'bold';
                            mgOptGroup.appendChild(option);
                            
                            // Add nested children recursively
                            if (mg.children && mg.children.length > 0) {
                                addHierarchyOptions(mgOptGroup, mg.children, 1);
                            }
                        });
                        
                        select.appendChild(mgOptGroup);
                    }
                    
                    // Add Subscriptions section
                    if (subscriptions && subscriptions.length > 0) {
                        const subOptGroup = document.createElement('optgroup');
                        subOptGroup.label = 'üîë Subscriptions';
                        
                        subscriptions.forEach((sub, index) => {
                            const option = document.createElement('option');
                            option.value = sub.id || sub.subscriptionId;
                            option.textContent = sub.displayName || sub.name;
                            if (managementGroups.length === 0 && index === 0) {
                                option.selected = true; // Select first subscription by default if no MGs
                            }
                            subOptGroup.appendChild(option);
                        });
                        
                        select.appendChild(subOptGroup);
                        
                        // Store subscriptions in session for later use
                        sessionStorage.setItem('azureSubscriptions', JSON.stringify(subscriptions));
                        sessionStorage.setItem('azureManagementGroups', JSON.stringify(managementGroups));
                        
                        // Update insights for first subscription
                        if (subscriptions.length > 0) {
                            updateInsightsForSubscription(subscriptions[0].id || subscriptions[0].subscriptionId);
                        }
                    } else if (managementGroups.length === 0) {
                        // No subscriptions or MGs found
                        select.innerHTML = '<option value="none">No subscriptions available</option>';
                    }
                } else {
                    console.error('Failed to load subscriptions hierarchy, falling back to subscriptions only');
                    // Fallback to regular subscriptions endpoint
                    const fallbackResponse = await fetch('/api/subscriptions', { headers });
                    if (fallbackResponse.ok) {
                        const subscriptions = await fallbackResponse.json();
                        select.innerHTML = '<option value="all">All Subscriptions</option>';
                        subscriptions.forEach((sub, index) => {
                            const option = document.createElement('option');
                            option.value = sub.id || sub.subscriptionId;
                            option.textContent = sub.displayName || sub.name;
                            if (index === 0) option.selected = true;
                            select.appendChild(option);
                        });
                    } else {
                        select.innerHTML = '<option value="current">Current Subscription</option>';
                    }
                }
            } catch (error) {
                console.error('Error loading subscriptions:', error);
                const select = document.getElementById('subscriptionSelect');
                select.innerHTML = '<option value="current">Current Subscription</option>';
            }
        }
        
        // Helper function to add hierarchical options
        function addHierarchyOptions(parent, children, depth) {
            const indent = '  '.repeat(depth);
            children.forEach(child => {
                const option = document.createElement('option');
                if (child.type === 'managementGroup') {
                    option.value = `mg:${child.id}`;
                    option.textContent = `${indent}üìÅ ${child.name}`;
                } else {
                    option.value = child.id;
                    option.textContent = `${indent}üîë ${child.name}`;
                }
                parent.appendChild(option);
                
                // Recursively add children
                if (child.children && child.children.length > 0) {
                    addHierarchyOptions(parent, child.children, depth + 1);
                }
            });
        }

        // Initialize
        window.addEventListener('load', () => {
            loadUserProfile();
            loadAzureSubscriptions();
            document.getElementById('userInput').focus();
        });
    </script>
</body>
</html>
